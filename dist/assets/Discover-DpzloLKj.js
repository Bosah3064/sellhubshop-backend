import{$ as le,r as l,s as f,w as v,j as s,A as Q,I as ne,B as g,b as F,e as P,d as n,o as V,X as M,S as I,f as oe,H as ce,M as de,a0 as me}from"./index-DIxCcwTo.js";import{S as xe}from"./slider-CEd1E7V-.js";import{C as O}from"./checkbox-J3xxe2-L.js";import{S as w}from"./skeleton-Dlpxet0e.js";import{S as he}from"./sliders-horizontal-CD39xJ8Q.js";import{P as fe}from"./package-GtKN0b3_.js";import"./index-BdQq_4o_.js";import"./index-DskgONLa.js";function ye(){const[R]=le(),y=R.get("search")||"",u=R.get("category")||"",[o,S]=l.useState(y),[N,T]=l.useState(!0),[r,b]=l.useState([0,1e8]),[c,C]=l.useState(u?[u]:[]),[d,$]=l.useState([]),[j,z]=l.useState([]),[E,k]=l.useState([]),[W,L]=l.useState(!0),[X,G]=l.useState([]),[A,_]=l.useState(new Set),J=["new","like-new","excellent","good","fair"],Y=[{label:"Under KES 10K",min:0,max:1e4},{label:"KES 10K - 50K",min:1e4,max:5e4},{label:"KES 50K - 100K",min:5e4,max:1e5},{label:"KES 100K - 500K",min:1e5,max:5e5},{label:"KES 500K - 1M",min:5e5,max:1e6},{label:"KES 1M - 5M",min:1e6,max:5e6},{label:"KES 5M - 10M",min:5e6,max:1e7},{label:"KES 10M - 50M",min:1e7,max:5e7},{label:"Over KES 50M",min:5e7,max:1e8}];l.useEffect(()=>{Z(),ee(),se()},[]),l.useEffect(()=>{S(y),u&&!c.includes(u)&&C([u])},[y,u]);const Z=async()=>{try{L(!0);const{data:e,error:a}=await f.from("products").select(`
          id,
          name,
          description,
          price,
          original_price,
          category,
          condition,
          location,
          images,
          featured,
          verified,
          is_negotiable,
          created_at,
          user_id
        `).in("status",["active","approved"]).order("created_at",{ascending:!1});if(a)throw a;if(e&&e.length>0){const t=e.map(h=>h.user_id).filter(Boolean),i=[...new Set(t)];let x={};if(i.length>0){const{data:h,error:ie}=await f.from("profiles").select("id, full_name, rating, total_ratings").in("id",i);!ie&&h&&h.forEach(H=>{x[H.id]=H})}const p=e.map(h=>({...h,profiles:h.user_id?x[h.user_id]:null}));z(p),k(p)}else z([]),k([])}catch(e){console.error("Error loading products:",e),v({variant:"destructive",title:"Error loading products",description:e.message})}finally{L(!1)}},ee=async()=>{try{const{data:e,error:a}=await f.from("products").select("category").eq("status","active").not("category","is",null);if(a)throw a;const t=[...new Set(e?.map(i=>i.category).filter(Boolean))];G(t.sort())}catch(e){console.error("Error loading categories:",e)}},se=async()=>{try{const{data:{user:e}}=await f.auth.getUser();if(!e)return;const{data:a,error:t}=await f.from("favorites").select("product_id").eq("user_id",e.id);if(t){console.error("Error loading favorites:",t);return}const i=new Set(a?.map(x=>x.product_id)||[]);_(i)}catch(e){console.error("Error loading favorites:",e)}},ae=async(e,a)=>{a?.stopPropagation();try{const{data:{user:t}}=await f.auth.getUser();if(!t){v({variant:"destructive",title:"Sign in required",description:"Please sign in to add favorites"});return}if(A.has(e)){const{error:i}=await f.from("favorites").delete().eq("product_id",e).eq("user_id",t.id);if(i)throw i;_(x=>{const p=new Set(x);return p.delete(e),p}),v({title:"Removed from favorites"})}else{const{error:i}=await f.from("favorites").insert({product_id:e,user_id:t.id});if(i)throw i;_(x=>new Set(x).add(e)),v({title:"Added to favorites"})}}catch(t){console.error("Error toggling favorite:",t),v({variant:"destructive",title:"Error updating favorites",description:t.message})}};l.useEffect(()=>{let e=j;o&&(e=e.filter(a=>a.name.toLowerCase().includes(o.toLowerCase())||a.description?.toLowerCase().includes(o.toLowerCase())||a.category?.toLowerCase().includes(o.toLowerCase()))),e=e.filter(a=>a.price>=r[0]&&a.price<=r[1]),c.length>0&&(e=e.filter(a=>a.category&&c.includes(a.category))),d.length>0&&(e=e.filter(a=>d.includes(a.condition))),k(e)},[o,r,c,d,j]);const D=e=>{C(a=>a.includes(e)?a.filter(t=>t!==e):[...a,e])},q=e=>{$(a=>a.includes(e)?a.filter(t=>t!==e):[...a,e])},te=(e,a)=>{b([e,a])},m=e=>e>=1e8?`KES ${(e/1e8).toFixed(1)}B`:e>=1e6?`KES ${(e/1e6).toFixed(1)}M`:e>=1e3?`KES ${(e/1e3).toFixed(0)}K`:`KES ${e}`,K=e=>e.split("-").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "),re=e=>e?.rating?{rating:e.rating,totalRatings:e.total_ratings||0}:null,B=()=>{C([]),$([]),b([0,1e8]),S("")},U=c.length+d.length+(r[0]>0||r[1]<1e8?1:0);return s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-secondary/5",children:s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Discover Amazing Deals"}),s.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Find exactly what you're looking for with our advanced search and filters"})]}),s.jsxs("div",{className:"flex flex-col md:flex-row gap-4 max-w-4xl mx-auto",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx(Q,{className:"absolute left-3 top-3 h-5 w-5 text-muted-foreground"}),s.jsx(ne,{placeholder:"Search products, categories, or descriptions...",value:o,onChange:e=>S(e.target.value),className:"pl-10 h-12 text-lg"})]}),s.jsxs(g,{variant:N?"default":"outline",size:"lg",onClick:()=>T(!N),className:"relative",children:[s.jsx(he,{className:"mr-2 h-5 w-5"}),"Filters",U>0&&s.jsx("span",{className:"absolute -top-2 -right-2 bg-primary text-primary-foreground text-xs rounded-full h-5 w-5 flex items-center justify-center",children:U})]})]})]}),s.jsxs("div",{className:"grid lg:grid-cols-4 gap-6",children:[N&&s.jsx(F,{className:"lg:col-span-1 h-fit sticky top-4",children:s.jsxs(P,{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"font-semibold text-lg",children:"Filters"}),s.jsx(g,{variant:"ghost",size:"sm",onClick:B,children:"Clear All"})]}),s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{children:[s.jsxs("h4",{className:"font-medium mb-4 flex items-center justify-between",children:[s.jsx("span",{children:"Price Range"}),s.jsxs(n,{variant:"secondary",className:"text-xs",children:[m(r[0])," -"," ",m(r[1])]})]}),s.jsx("div",{className:"space-y-2 mb-4",children:Y.map((e,a)=>s.jsx(g,{variant:r[0]===e.min&&r[1]===e.max?"default":"outline",size:"sm",className:"w-full justify-start text-xs h-8",onClick:()=>te(e.min,e.max),children:e.label},a))}),s.jsx(xe,{value:r,onValueChange:b,max:1e8,step:1e5,className:"mb-3"}),s.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[s.jsx("span",{children:m(0)}),s.jsxs("span",{children:[m(1e8),"+"]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"Categories"}),s.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:X.map(e=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(O,{id:`cat-${e}`,checked:c.includes(e),onCheckedChange:()=>D(e)}),s.jsxs(V,{htmlFor:`cat-${e}`,className:"cursor-pointer flex-1 flex justify-between items-center",children:[s.jsx("span",{className:"capitalize",children:e}),s.jsx(n,{variant:"outline",className:"text-xs",children:j.filter(a=>a.category===e).length})]})]},e))})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"Condition"}),s.jsx("div",{className:"space-y-3",children:J.map(e=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(O,{id:`cond-${e}`,checked:d.includes(e),onCheckedChange:()=>q(e)}),s.jsxs(V,{htmlFor:`cond-${e}`,className:"cursor-pointer flex-1 flex justify-between items-center",children:[s.jsx("span",{children:K(e)}),s.jsx(n,{variant:"outline",className:"text-xs",children:j.filter(a=>a.condition===e).length})]})]},e))})]})]})]})}),s.jsxs("div",{className:N?"lg:col-span-3":"lg:col-span-4",children:[s.jsxs("div",{className:"mb-6 flex flex-wrap gap-2",children:[c.map(e=>s.jsxs(n,{variant:"secondary",className:"gap-2 py-1.5",children:[e,s.jsx(M,{className:"h-3 w-3 cursor-pointer hover:scale-110 transition-transform",onClick:()=>D(e)})]},e)),d.map(e=>s.jsxs(n,{variant:"secondary",className:"gap-2 py-1.5",children:[K(e),s.jsx(M,{className:"h-3 w-3 cursor-pointer hover:scale-110 transition-transform",onClick:()=>q(e)})]},e)),(r[0]>0||r[1]<1e8)&&s.jsxs(n,{variant:"secondary",className:"gap-2 py-1.5",children:["Price: ",m(r[0])," -"," ",m(r[1]),s.jsx(M,{className:"h-3 w-3 cursor-pointer hover:scale-110 transition-transform",onClick:()=>b([0,1e8])})]})]}),s.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[s.jsxs("p",{className:"text-muted-foreground",children:["Showing ",E.length," of ",j.length," products"]}),o&&s.jsxs("p",{className:"text-sm text-muted-foreground",children:['Results for "',s.jsx("span",{className:"font-medium text-foreground",children:o}),'"']})]}),W?s.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,a)=>s.jsxs(F,{className:"overflow-hidden",children:[s.jsx(w,{className:"w-full h-48"}),s.jsxs(P,{className:"p-4 space-y-3",children:[s.jsx(w,{className:"h-4 w-3/4"}),s.jsx(w,{className:"h-6 w-1/2"}),s.jsx(w,{className:"h-4 w-full"})]})]},a))}):E.length===0?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Q,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),s.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No products found"}),s.jsx("p",{className:"text-muted-foreground mb-6",children:o||c.length>0||d.length>0||r[0]>0||r[1]<1e8?"Try adjusting your search criteria or filters":"No products available at the moment"}),(o||c.length>0||d.length>0||r[0]>0||r[1]<1e8)&&s.jsx(g,{onClick:B,children:"Clear All Filters"})]}):s.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:E.map(e=>{const a=re(e.profiles),t=A.has(e.id);return s.jsxs(F,{className:"overflow-hidden hover:shadow-xl transition-all duration-300 group cursor-pointer border-0 shadow-md",children:[s.jsxs("div",{className:"relative",children:[e.images?.[0]?s.jsx("img",{src:e.images[0],alt:e.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}):s.jsx("div",{className:"w-full h-48 bg-muted flex items-center justify-center",children:s.jsx(fe,{className:"h-12 w-12 text-muted-foreground"})}),s.jsxs("div",{className:"absolute top-3 left-3 flex gap-1",children:[e.featured&&s.jsxs(n,{className:"bg-yellow-500 hover:bg-yellow-600",children:[s.jsx(I,{className:"h-3 w-3 mr-1 fill-current"}),"Featured"]}),e.verified&&s.jsxs(n,{variant:"secondary",className:"bg-green-500 hover:bg-green-600",children:[s.jsx(oe,{className:"h-3 w-3 mr-1"}),"Verified"]})]}),e.is_negotiable&&s.jsx(n,{variant:"secondary",className:"absolute top-3 right-3 bg-blue-500",children:"Negotiable"}),s.jsx(g,{size:"icon",variant:"secondary",className:`absolute top-12 right-3 backdrop-blur-sm transition-all duration-200 ${t?"bg-red-50 hover:bg-red-100 border-red-200":"bg-background/80 hover:bg-background"}`,onClick:i=>ae(e.id,i),children:s.jsx(ce,{className:`h-4 w-4 transition-all duration-200 ${t?"fill-red-500 text-red-500 scale-110":"text-gray-600 hover:text-red-500"}`})})]}),s.jsxs(P,{className:"p-4",children:[s.jsx("div",{className:"flex items-start justify-between mb-2",children:s.jsx("h3",{className:"font-semibold text-lg leading-tight line-clamp-2 flex-1 mr-2",children:e.name})}),s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("p",{className:"text-2xl font-bold text-primary",children:m(e.price)}),e.original_price&&e.original_price>e.price&&s.jsx("p",{className:"text-sm text-muted-foreground line-through",children:m(e.original_price)})]}),s.jsx("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx(n,{variant:"outline",className:"capitalize",children:e.category}),s.jsx(n,{variant:"secondary",className:"capitalize",children:K(e.condition)})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[s.jsx(de,{className:"h-3 w-3"}),s.jsx("span",{className:"line-clamp-1",children:e.location})]}),a&&s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(I,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),s.jsx("span",{className:"font-medium",children:a.rating.toFixed(1)}),s.jsxs("span",{className:"text-muted-foreground",children:["(",a.totalRatings,")"]})]})]})]}),s.jsx(me,{className:"p-4 pt-0",children:s.jsx(g,{className:"w-full",size:"sm",children:"View Details"})})]},e.id)})})]})]})]})})}export{ye as default};
