import{v as p,r as l,j as e,b as f,e as b,D as j,B as m,aX as w,q as y,s as i}from"./index-DIxCcwTo.js";function A(){const t=p(),[o,n]=l.useState("Completing sign in..."),[c,g]=l.useState(null);l.useEffect(()=>{(async()=>{try{n("Processing authentication...");const{data:{session:s},error:r}=await i.auth.getSession();if(r)throw console.error("Session error:",r),new Error(`Authentication failed: ${r.message}`);if(s?.user){n("Authentication successful! Updating profile...");const{error:a}=await i.from("profiles").update({last_login:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",s.user.id);a&&console.warn("Profile update warning:",a);const u={id:crypto.randomUUID(),action_type:"user_oauth_login_success",resource_type:"auth",resource_id:s.user.id,admin_id:null,details:{email:s.user.email,user_id:s.user.id,type:"oauth",provider:s.user.app_metadata?.provider||"unknown"}};console.log("OAuth Success Log Payload:",u);const{error:d}=await i.from("admin_actions").insert(u);d&&console.error("Error logging OAuth success:",d),n("Redirecting to dashboard..."),setTimeout(()=>{t("/dashboard",{replace:!0})},1e3)}else throw new Error("No user session found. Please try signing in again.")}catch(s){console.error("Auth callback error:",s),g(s.message),n("Authentication failed");const r={id:crypto.randomUUID(),action_type:"user_oauth_login_failed",resource_type:"auth",details:{error:s.message,timestamp:new Date().toISOString()}};console.log("OAuth Failure Log Payload:",r);const{error:a}=await i.from("admin_actions").insert(r);a&&console.error("Error logging OAuth failure:",a),setTimeout(()=>{t("/signin",{replace:!0})},3e3)}})()},[t]);const h=()=>{t("/signin",{replace:!0})},x=()=>{t("/",{replace:!0})};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsx(f,{className:"w-full max-w-md text-center",children:e.jsx(b,{className:"pt-6",children:c?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2 text-red-600",children:"Authentication Failed"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{onClick:h,className:"w-full",children:"Try Again"}),e.jsx(m,{onClick:x,variant:"outline",className:"w-full",children:"Go Home"})]})]}):o.includes("successful")||o.includes("Redirecting")?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Success!"}),e.jsx("p",{className:"text-gray-600",children:o})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-12 w-12 animate-spin text-blue-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Processing"}),e.jsx("p",{className:"text-gray-600",children:o})]})})})})}export{A as default};
