import{u as se,v as re,$ as ae,r as i,s as x,j as e,f as te,Z as le,b as k,e as _,aS as L,x as oe,y as ie,a8 as ce,aV as ne,B as G,o as p,a1 as de,I as g,b2 as u,F as me,aB as V,aX as xe,L as A}from"./index-DIxCcwTo.js";import{a as ue,t as he,o as fe,l as pe,s as j}from"./types-BUNQPvk4.js";import{U as ge}from"./users-DBPXf3v8.js";import{U as $}from"./user-plus-CkgzSKE5.js";import{E as B}from"./eye-off-BjvTbt_r.js";import{E as z}from"./eye-DkAcDlvf.js";import{B as je}from"./badge-check-8Elt7ytW.js";import{A as we}from"./arrow-right-CWu2P4sX.js";const be=fe({name:j().min(2,"Full name must be at least 2 characters").max(50,"Full name must be less than 50 characters").regex(/^[a-zA-Z\s]+$/,"Name can only contain letters and spaces"),email:j().email("Please enter a valid email address"),password:j().min(8,"Password must be at least 8 characters").regex(/[A-Z]/,"Must contain at least one uppercase letter").regex(/[a-z]/,"Must contain at least one lowercase letter").regex(/[0-9]/,"Must contain at least one number").regex(/[^A-Za-z0-9]/,"Must contain at least one special character"),confirmPassword:j(),acceptTOS:pe(!0,{errorMap:()=>({message:"You must accept the Terms of Service and Privacy Policy"})})}).refine(c=>c.password===c.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function Te(){const{toast:c}=se(),q=re(),[Z]=ae(),a=Z.get("ref"),[w,Y]=i.useState(!1),[b,D]=i.useState(!1),[E,O]=i.useState(!1),[n,N]=i.useState(null),[y,T]=i.useState(!1),[v,C]=i.useState(0),{register:h,handleSubmit:H,formState:{errors:t,isSubmitting:Ne},watch:f,trigger:ye}=ue({resolver:he(be),mode:"onChange"}),o=f("password"),P=f("email"),R=f("name");i.useEffect(()=>{let s=0;R?.length>=2&&(s+=25),P?.includes("@")&&P?.includes(".")&&(s+=25),o?.length>=8&&(s+=25),f("acceptTOS")&&(s+=25),C(s)},[R,P,o,f("acceptTOS")]),i.useEffect(()=>{a&&J(a)},[a]);const J=async s=>{try{const{data:r,error:l}=await x.from("referral_codes").select(`
          user_id,
          profiles:user_id (
            full_name
          )
        `).eq("code",s).eq("is_active",!0).single();if(l){console.error("Referral code error:",l),N({name:"",isValid:!1});return}r&&(N({name:r.profiles?.full_name||"a friend",isValid:!0}),c({title:"ðŸŽ‰ Referral Bonus Activated!",description:`You're joining through ${r.profiles?.full_name||"a friend"}'s network`}))}catch(r){console.error("Error checking referral code:",r),N({name:"",isValid:!1})}},W=async s=>{try{console.log("ðŸ” Checking for user's referral code...");const{data:r,error:l}=await x.from("referral_codes").select("code").eq("user_id",s).eq("is_active",!0).single();return!l&&r?(console.log("âœ… Found user's referral code:",r.code),r.code):(console.log("â„¹ï¸ No referral code found yet - database triggers will create one automatically"),null)}catch(r){return console.error("ðŸ’¥ Error checking user referral code:",r),null}},M=[{label:"At least 8 characters",met:o?.length>=8},{label:"One uppercase letter",met:/[A-Z]/.test(o)},{label:"One lowercase letter",met:/[a-z]/.test(o)},{label:"One number",met:/[0-9]/.test(o)},{label:"One special character",met:/[^A-Za-z0-9]/.test(o)}],X=M.every(s=>s.met),K=async s=>{try{console.log("ðŸš€ Starting professional registration process..."),T(!0),C(100);const r={name:s.name};a&&n?.isValid&&(r.referral_code=a,console.log("ðŸŽ¯ Using referral code:",a)),console.log("ðŸ” Creating secure account...");const{data:l,error:d}=await x.auth.signUp({email:s.email.toLowerCase(),password:s.password,options:{data:r,emailRedirectTo:`${window.location.origin}/auth/callback`}});if(d)throw console.error("âŒ Authentication error:",d),d.message?.toLowerCase().includes("user already registered")||d.message?.toLowerCase().includes("already exists")||d.status===422?new Error("An account with this email already exists. Please sign in or use a different email address."):new Error(d.message||"Registration failed. Please try again.");if(!l.user)throw new Error("Account creation failed. Please try again.");console.log("âœ… Account created successfully"),console.log("ðŸ“ Creating/updating profile with referral tracking..."),console.log("ðŸ“ Creating/updating profile with referral tracking...");const ee={id:l.user.id,email:s.email.toLowerCase(),full_name:s.name,referral_code_used:a&&n?.isValid?a:null,updated_at:new Date().toISOString()},{error:F}=await x.from("profiles").upsert(ee,{onConflict:"id"});if(F)console.error("âŒ Profile upsert error:",F);else if(console.log("âœ… Profile created/updated successfully"),a&&n?.isValid)try{console.log("ðŸ“ Creating pending referral record via API...");const{data:m}=await x.from("referral_codes").select("user_id").eq("code",a).eq("is_active",!0).single();if(m?.user_id){const I=await fetch("https://sellhubshop-backend.onrender.com/referrals/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({referrer_id:m.user_id,referred_id:l.user.id,referral_code_used:a})}),S=await I.json();!I.ok||!S.success?console.error("âŒ Error creating referral record:",S.error):console.log("âœ… Pending referral record created:",S.data.id)}}catch(m){console.error("ðŸ’¥ Failed to process referral registration:",m)}console.log("â³ Waiting for automatic processes..."),await new Promise(m=>setTimeout(m,2e3));const U=await W(l.user.id);c({title:"ðŸŽ‰ Welcome to Our Marketplace!",description:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:"Your account has been created successfully."}),a&&n?.isValid&&e.jsxs("p",{className:"font-semibold text-green-600",children:[e.jsx(L,{className:"w-4 h-4 inline mr-1"}),"Referral recorded! You'll earn rewards when you become an active seller."]}),U&&e.jsxs("p",{className:"text-sm text-blue-600",children:["Your personal referral code: ",e.jsx("strong",{children:U})]}),e.jsx("p",{children:"Check your email to verify your account."})]})}),setTimeout(()=>{q("/signin",{state:{message:"Account created successfully! Please check your email to verify your account."}})},2e3)}catch(r){console.error("ðŸ’¥ Registration error:",r);const l=r instanceof Error?r.message:"An unexpected error occurred";c({variant:"destructive",title:"Registration Failed",description:l}),C(0)}finally{T(!1)}},Q=async()=>{O(!0);try{const s={};a&&n?.isValid&&(s.referral_code=a,console.log("ðŸŽ¯ Google signup with referral code:",a));const{error:r}=await x.auth.signInWithOAuth({provider:"google",options:{queryParams:{access_type:"offline",prompt:"consent"},redirectTo:`${window.location.origin}/auth/callback?ref=${a||""}`}});if(r)throw r;console.log("âœ… Google OAuth initiated with referral tracking")}catch(s){console.error("Google sign up error:",s),c({variant:"destructive",title:"Google Sign Up Failed",description:"Unable to sign up with Google. Please try again."})}finally{O(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-2xl grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"flex flex-col justify-center space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center",children:e.jsx(te,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:"Enterprise Security"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Bank-level encryption & protection"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:"Instant Setup"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Start selling in minutes"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:e.jsx(ge,{className:"w-6 h-6 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:"10,000+ Sellers"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Join our growing community"})]})]})]}),a&&n?.isValid&&e.jsx(k,{className:"bg-gradient-to-r from-green-50 to-emerald-100 border-green-200",children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-800",children:"Referral Bonus Active"}),e.jsxs("p",{className:"text-sm text-green-700",children:["You're joining through ",n.name,"'s network"]}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Eligible for special rewards when you become an active seller"})]})]})})}),!a&&e.jsx(k,{className:"bg-gradient-to-r from-blue-50 to-indigo-100 border-blue-200",children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx($,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-800",children:"Join Our Community"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Start your selling journey today"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"No invitation needed - everyone is welcome!"})]})]})})})]}),e.jsxs(k,{className:"w-full shadow-2xl border-0 bg-white/80 backdrop-blur-sm",children:[e.jsxs(oe,{className:"space-y-4 text-center pb-6",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-600 to-purple-600 rounded-2xl flex items-center justify-center",children:e.jsx($,{className:"w-8 h-8 text-white"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ie,{className:"text-2xl font-bold bg-gradient-to-r from-slate-900 to-slate-700 bg-clip-text text-transparent",children:"Create Professional Account"}),e.jsx(ce,{className:"text-slate-600",children:"Join Kenya's fastest-growing marketplace platform"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-slate-600",children:[e.jsx("span",{children:"Profile Completion"}),e.jsxs("span",{children:[v,"%"]})]}),e.jsx(ne,{value:v,className:"h-2"})]})]}),e.jsxs(_,{className:"space-y-6",children:[e.jsxs(G,{type:"button",variant:"outline",className:"w-full h-12 border-slate-300 hover:bg-slate-50 transition-all duration-200",onClick:Q,disabled:y||E,children:[e.jsxs("svg",{className:"w-5 h-5 mr-3",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),E?"Connecting to Google...":"Continue with Google"]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t border-slate-300"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-white px-3 text-slate-500 font-medium",children:"Or register with email"})})]}),e.jsxs("form",{onSubmit:H(K),className:"space-y-5",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{htmlFor:"name",className:"text-sm font-semibold text-slate-700",children:"Full Name"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(g,{id:"name",type:"text",placeholder:"Enter your full name",...h("name"),className:`h-12 pl-10 ${t.name?"border-red-500 focus:ring-red-500":"border-slate-300 focus:ring-blue-500"}`})]}),t.name&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),t.name.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{htmlFor:"email",className:"text-sm font-semibold text-slate-700",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(g,{id:"email",type:"email",placeholder:"your.email@company.com",...h("email"),className:`h-12 pl-10 ${t.email?"border-red-500 focus:ring-red-500":"border-slate-300 focus:ring-blue-500"}`})]}),t.email&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),t.email.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{htmlFor:"password",className:"text-sm font-semibold text-slate-700",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(g,{id:"password",type:w?"text":"password",placeholder:"Create a strong password",...h("password"),className:`h-12 pl-10 pr-10 ${t.password?"border-red-500 focus:ring-red-500":"border-slate-300 focus:ring-blue-500"}`}),e.jsx("button",{type:"button",onClick:()=>Y(!w),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors",children:w?e.jsx(B,{className:"w-4 h-4"}):e.jsx(z,{className:"w-4 h-4"})})]}),o&&e.jsxs("div",{className:"space-y-2 p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Password Strength"}),X&&e.jsx(je,{className:"w-4 h-4 text-green-500"})]}),M.map((s,r)=>e.jsxs("div",{className:"flex items-center text-sm",children:[s.met?e.jsx(xe,{className:"h-4 w-4 text-green-500 mr-2"}):e.jsx(u,{className:"h-4 w-4 text-slate-400 mr-2"}),e.jsx("span",{className:s.met?"text-green-600 font-medium":"text-slate-600",children:s.label})]},r))]}),t.password&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),t.password.message]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(p,{htmlFor:"confirmPassword",className:"text-sm font-semibold text-slate-700",children:"Confirm Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(g,{id:"confirmPassword",type:b?"text":"password",placeholder:"Confirm your password",...h("confirmPassword"),className:`h-12 pl-10 pr-10 ${t.confirmPassword?"border-red-500 focus:ring-red-500":"border-slate-300 focus:ring-blue-500"}`}),e.jsx("button",{type:"button",onClick:()=>D(!b),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 transition-colors",children:b?e.jsx(B,{className:"w-4 h-4"}):e.jsx(z,{className:"w-4 h-4"})})]}),t.confirmPassword&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),t.confirmPassword.message]})]}),e.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("input",{type:"checkbox",id:"acceptTOS",...h("acceptTOS"),className:"mt-0.5 h-4 w-4 text-blue-600 focus:ring-blue-500 border-slate-300 rounded"}),e.jsxs(p,{htmlFor:"acceptTOS",className:"text-sm font-normal leading-5 text-slate-700",children:["I agree to the"," ",e.jsx(A,{to:"/terms",className:"text-blue-600 hover:underline font-semibold",children:"Terms of Service"})," ","and"," ",e.jsx(A,{to:"/privacy",className:"text-blue-600 hover:underline font-semibold",children:"Privacy Policy"}),". I understand that my data will be processed securely."]})]}),t.acceptTOS&&e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),t.acceptTOS.message]}),e.jsx(G,{type:"submit",className:"w-full h-12 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold shadow-lg hover:shadow-xl transition-all duration-200",disabled:y||v<100,children:y?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-3"}),"Creating Account..."]}):e.jsxs("div",{className:"flex items-center",children:["Create Professional Account",e.jsx(we,{className:"w-4 h-4 ml-2"})]})}),e.jsxs("p",{className:"text-sm text-center text-slate-600",children:["Already have an account?"," ",e.jsx(A,{to:"/signin",className:"text-blue-600 hover:underline font-semibold transition-colors",children:"Sign in to your account"})]})]})]})]})]})})}export{Te as default};
