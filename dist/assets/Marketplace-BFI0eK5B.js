import{c as qe,s as l,r as a,G as Ss,J as Pt,K as Et,j as e,N as _s,R as Mt,O as ue,Q as $e,U as It,V as Ae,W as Dt,Y as At,n as ks,_ as Ft,B as h,o as P,z as hs,I as de,g as H,S as K,f as qt,v as $t,$ as Ot,a as Tt,Z as Lt,A as Pe,X as Ut,T as zt,M as V,d as I,b as gs,x as Vt,e as Ht,a0 as Kt,L as Gt,H as fs,a1 as vs,a2 as ys,a3 as Bt,C as Wt,a4 as Jt,a5 as Yt,P as Qt,a6 as bs,w as g}from"./index-DIxCcwTo.js";import{S as Xt}from"./SEO-DRdgyEjE.js";import{S as D}from"./skeleton-Dlpxet0e.js";import{D as ae,a as ie,d as oe,c as ne,e as le,f as Zt}from"./dialog-YYEI7PMn.js";import{T as js}from"./textarea-QQPFZBv8.js";import{A as Ee,a as Me,b as Ie}from"./avatar-C_jNKov4.js";import{k as me}from"./kenyan-locations-B_zgBGGF.js";import{S as er}from"./scroll-area-C5w8SCdh.js";import{S as sr}from"./separator-DYUwGkHk.js";import{C as tr}from"./PriceDisplay-_QDTrlZ3.js";import{C as rr}from"./ContactSellerDialog-Fr5gEQDa.js";import{S as ar}from"./slider-CEd1E7V-.js";import{S as ir}from"./switch-Cu0j0zPN.js";import{u as or}from"./index-DskgONLa.js";import{R as Fe}from"./rotate-ccw-CB571PKh.js";import{C as nr}from"./circle-check-BFErec5s.js";import{H as ws}from"./history-DAXOqsNw.js";import{F as lr}from"./filter-CcvaBCEE.js";import{P as ce}from"./package-GtKN0b3_.js";import{S as cr}from"./shield-check-CLmxCABJ.js";import{T as dr}from"./trending-down-DBiRQaEc.js";import{E as Ns}from"./eye-DkAcDlvf.js";import{C as mr}from"./calendar-CuODnOhg.js";import{T as ur}from"./thumbs-up-dZPjuOmQ.js";import{S as xr}from"./send-TktZal_A.js";import{W as pr}from"./wifi-off-CTt2b_ev.js";import"./index-BdQq_4o_.js";import"./copy-YHHq3K_B.js";import"./message-circle-C61Fvmn6.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=qe("SignalHigh",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=qe("SignalLow",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=qe("SignalMedium",[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}]]);async function vr(d){try{const{data:{user:u}}=await l.auth.getUser();console.log("ðŸ” Tracking view for product:",d,"User:",u?.id);const{error:n}=await l.from("product_views").insert({product_id:d,user_id:u?.id||null,created_at:new Date().toISOString()});n?(console.error("âŒ Error inserting into product_views:",n),n.code==="23505"?console.log("View already tracked for this user/product"):console.log("Continuing to update views_count despite tracking error")):console.log("âœ… Successfully recorded in product_views table");const{error:o}=await l.rpc("increment_product_views",{product_id:d});return o?(console.error("âŒ Error updating views_count via RPC:",o),!1):(console.log("âœ… Successfully updated views_count for product:",d),!0)}catch(u){return console.error("ðŸ’¥ Unexpected error in trackProductView:",u),!1}}var Oe="Radio",[yr,Cs]=_s(Oe),[br,jr]=yr(Oe),Rs=a.forwardRef((d,u)=>{const{__scopeRadio:n,name:o,checked:m=!1,required:f,disabled:N,value:k="on",onCheck:S,form:C,...v}=d,[y,_]=a.useState(null),w=$e(u,M=>_(M)),b=a.useRef(!1),E=y?C||!!y.closest("form"):!0;return e.jsxs(br,{scope:n,checked:m,disabled:N,children:[e.jsx(ue.button,{type:"button",role:"radio","aria-checked":m,"data-state":Is(m),"data-disabled":N?"":void 0,disabled:N,value:k,...v,ref:w,onClick:Ae(d.onClick,M=>{m||S?.(),E&&(b.current=M.isPropagationStopped(),b.current||M.stopPropagation())})}),E&&e.jsx(Ms,{control:y,bubbles:!b.current,name:o,value:k,checked:m,required:f,disabled:N,form:C,style:{transform:"translateX(-100%)"}})]})});Rs.displayName=Oe;var Ps="RadioIndicator",Es=a.forwardRef((d,u)=>{const{__scopeRadio:n,forceMount:o,...m}=d,f=jr(Ps,n);return e.jsx(Dt,{present:o||f.checked,children:e.jsx(ue.span,{"data-state":Is(f.checked),"data-disabled":f.disabled?"":void 0,...m,ref:u})})});Es.displayName=Ps;var wr="RadioBubbleInput",Ms=a.forwardRef(({__scopeRadio:d,control:u,checked:n,bubbles:o=!0,...m},f)=>{const N=a.useRef(null),k=$e(N,f),S=or(n),C=At(u);return a.useEffect(()=>{const v=N.current;if(!v)return;const y=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(y,"checked").set;if(S!==n&&w){const b=new Event("click",{bubbles:o});w.call(v,n),v.dispatchEvent(b)}},[S,n,o]),e.jsx(ue.input,{type:"radio","aria-hidden":!0,defaultChecked:n,...m,tabIndex:-1,ref:k,style:{...m.style,...C,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ms.displayName=wr;function Is(d){return d?"checked":"unchecked"}var Nr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],xe="RadioGroup",[Sr]=_s(xe,[Ss,Cs]),Ds=Ss(),As=Cs(),[_r,kr]=Sr(xe),Fs=a.forwardRef((d,u)=>{const{__scopeRadioGroup:n,name:o,defaultValue:m,value:f,required:N=!1,disabled:k=!1,orientation:S,dir:C,loop:v=!0,onValueChange:y,..._}=d,w=Ds(n),b=Pt(C),[E,M]=Et({prop:f,defaultProp:m??null,onChange:y,caller:xe});return e.jsx(_r,{scope:n,name:o,required:N,disabled:k,value:E,onValueChange:M,children:e.jsx(Mt,{asChild:!0,...w,orientation:S,dir:b,loop:v,children:e.jsx(ue.div,{role:"radiogroup","aria-required":N,"aria-orientation":S,"data-disabled":k?"":void 0,dir:b,..._,ref:u})})})});Fs.displayName=xe;var qs="RadioGroupItem",$s=a.forwardRef((d,u)=>{const{__scopeRadioGroup:n,disabled:o,...m}=d,f=kr(qs,n),N=f.disabled||o,k=Ds(n),S=As(n),C=a.useRef(null),v=$e(u,C),y=f.value===m.value,_=a.useRef(!1);return a.useEffect(()=>{const w=E=>{Nr.includes(E.key)&&(_.current=!0)},b=()=>_.current=!1;return document.addEventListener("keydown",w),document.addEventListener("keyup",b),()=>{document.removeEventListener("keydown",w),document.removeEventListener("keyup",b)}},[]),e.jsx(It,{asChild:!0,...k,focusable:!N,active:y,children:e.jsx(Rs,{disabled:N,required:f.required,checked:y,...S,...m,name:f.name,ref:v,onCheck:()=>f.onValueChange(m.value),onKeyDown:Ae(w=>{w.key==="Enter"&&w.preventDefault()}),onFocus:Ae(m.onFocus,()=>{_.current&&C.current?.click()})})})});$s.displayName=qs;var Cr="RadioGroupIndicator",Os=a.forwardRef((d,u)=>{const{__scopeRadioGroup:n,...o}=d,m=As(n);return e.jsx(Es,{...m,...o,ref:u})});Os.displayName=Cr;var Ts=Fs,Ls=$s,Rr=Os;const Us=a.forwardRef(({className:d,...u},n)=>e.jsx(Ts,{className:ks("grid gap-2",d),...u,ref:n}));Us.displayName=Ts.displayName;const zs=a.forwardRef(({className:d,...u},n)=>e.jsx(Ls,{ref:n,className:ks("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",d),...u,children:e.jsx(Rr,{className:"flex items-center justify-center",children:e.jsx(Ft,{className:"h-2.5 w-2.5 fill-current text-current"})})}));zs.displayName=Ls.displayName;function Pr({categories:d,selectedCategory:u,onCategoryChange:n,priceRange:o,onPriceRangeChange:m,conditions:f,onConditionChange:N,verifiedOnly:k,onVerifiedChange:S,onReset:C,className:v="",selectedCounty:y="",onCountyChange:_,selectedNeighborhood:w="",onNeighborhoodChange:b}){const[E,M]=a.useState([]),[G,O]=a.useState([]);a.useEffect(()=>{pe()},[]),a.useEffect(()=>{y?B(y):O([])},[y]);const pe=async()=>{const t=me.counties.map(R=>({id:R.id,name:R.name}));M(t)},B=async t=>{const R=me.counties.find(F=>F.id===t||F.name===t);O(R?R.locations.map(F=>({id:F,name:F})):[])},T=t=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",maximumFractionDigits:0}).format(t);return e.jsxs("div",{className:`space-y-6 bg-white p-4 rounded-lg border border-gray-100 h-fit ${v}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Filters"}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:C,className:"text-muted-foreground hover:text-primary h-8",children:[e.jsx(Fe,{className:"h-3.5 w-3.5 mr-1"}),"Reset"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(nr,{className:"h-4 w-4 text-primary"}),e.jsx(P,{htmlFor:"verified-mode",className:"font-medium cursor-pointer",children:"Verified Only"})]}),e.jsx(ir,{id:"verified-mode",checked:k,onCheckedChange:S})]}),e.jsxs("div",{className:"space-y-3 pb-4 border-b border-gray-100",children:[e.jsx(P,{className:"text-sm font-medium",children:"County"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:y,onChange:t=>_?.(t.target.value),className:"w-full pl-3 pr-10 py-2 text-sm border border-gray-200 rounded-md appearance-none focus:outline-none focus:ring-2 focus:ring-primary/20 bg-white",children:[e.jsx("option",{value:"",children:"All Counties"}),E.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx(hs,{className:"absolute right-3 top-2.5 h-4 w-4 text-muted-foreground pointer-events-none"})]})]}),e.jsxs("div",{className:"space-y-3 pb-4 border-b border-gray-100",children:[e.jsx(P,{className:"text-sm font-medium",children:"Specific Area"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:w,onChange:t=>b?.(t.target.value),disabled:!y,className:"w-full pl-3 pr-10 py-2 text-sm border border-gray-200 rounded-md appearance-none focus:outline-none focus:ring-2 focus:ring-primary/20 bg-white disabled:bg-gray-50 disabled:text-gray-400",children:[e.jsx("option",{value:"",children:y?"All Areas":"Select County first"}),G.map(t=>e.jsx("option",{value:t.name,children:t.name},t.id))]}),e.jsx(hs,{className:"absolute right-3 top-2.5 h-4 w-4 text-muted-foreground pointer-events-none"})]})]}),e.jsxs("div",{className:"space-y-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{className:"text-sm font-medium",children:"Price Range"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[T(o[0])," - ",o[1]>=1e6?"1M+":T(o[1])]})]}),e.jsx(ar,{defaultValue:[0,1e6],min:0,max:1e6,step:1e3,value:[o[0],o[1]],onValueChange:t=>m([t[0],t[1]]),className:"py-4"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{type:"number",value:o[0],onChange:t=>m([Number(t.target.value),o[1]]),className:"h-8 text-xs",placeholder:"Min"}),e.jsx("span",{className:"text-muted-foreground",children:"-"}),e.jsx(de,{type:"number",value:o[1],onChange:t=>m([o[0],Number(t.target.value)]),className:"h-8 text-xs",placeholder:"Max"})]})]}),e.jsxs("div",{className:"space-y-4 pb-6 border-b border-gray-100",children:[e.jsx(P,{className:"text-sm font-semibold text-gray-900",children:"Condition"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{label:"New",icon:H},{label:"Used - Like New",icon:K},{label:"Used - Good",icon:qt},{label:"Refurbished",icon:Fe}].map(({label:t,icon:R})=>e.jsxs(h,{type:"button",variant:f.includes(t)?"default":"outline",size:"sm",className:`
                                rounded-full h-9 px-4 text-xs font-medium transition-all duration-200
                                ${f.includes(t)?"bg-primary text-white border-primary shadow-md":"bg-white text-gray-600 border-gray-200 hover:border-primary hover:text-primary"}
                            `,onClick:()=>N(t),children:[e.jsx(R,{className:`h-3 w-3 mr-2 ${f.includes(t)?"text-white":"text-primary"}`}),t]},t))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P,{className:"text-sm font-medium",children:"Categories"}),e.jsx(Us,{value:u,onValueChange:n,className:"space-y-1",children:d.slice(0,10).map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(zs,{value:t,id:`cat-${t}`}),e.jsx(P,{htmlFor:`cat-${t}`,className:"text-sm font-normal cursor-pointer",children:t})]},t))})]})]})}const De=["All","Electronics","Fashion","Home & Garden","Books","Sports","Beauty","Vehicles","Toys","Jewelry","Health","Food","Pets","Office","Art & Crafts","Music","Baby & Kids","Travel","Industrial","Collectibles"];function ua(){console.log("ðŸ” Marketplace component rendering..."),$t();const[d]=Ot(),[u,n]=a.useState("All"),[o,m]=a.useState(""),[f,N]=a.useState([]),{addToCart:k}=Tt(),[S,C]=a.useState([0,1e6]),[v,y]=a.useState(""),[_,w]=a.useState(""),[b,E]=a.useState([]),[M,G]=a.useState(!1),[O,pe]=a.useState("newest"),[B,T]=a.useState(new Set),[t,R]=a.useState(null),[F,Te]=a.useState(!1),[Vs,Le]=a.useState(!1),[Hs,Ue]=a.useState(!1),[ze,Ve]=a.useState(!0),[Ks,he]=a.useState([]),[ge,He]=a.useState([]),[L,fe]=a.useState({rating:5,comment:""}),[Ke,Ge]=a.useState(!1),[ve,Gs]=a.useState([]),[U,Be]=a.useState(""),[Bs,We]=a.useState(!1),[Je,Ye]=a.useState(null),[Ws,Js]=a.useState(!1),[Qe,Ys]=a.useState(null),[Er,Mr]=a.useState(!1),[Qs,ye]=a.useState(!1),[W,Xe]=a.useState(""),[z,Ze]=a.useState(""),[Xs,es]=a.useState(!1),[Zs,et]=a.useState([]),[J,Y]=a.useState([]),[Ir,st]=a.useState(!1),[Dr,tt]=a.useState([]),[Ar,Fr]=a.useState(!1),[be,Q]=a.useState("secure"),[rt,ss]=a.useState(!1),[qr,X]=a.useState(!1),[at,je]=a.useState(!1),[we,q]=a.useState(0),[Ne,Z]=a.useState(!1),ts=s=>s?(new Date().getTime()-new Date(s).getTime())/6e4<10:!1,it=s=>{if(!s)return"Offline";const r=Math.floor((new Date().getTime()-new Date(s).getTime())/6e4);if(r<1)return"Online now";if(r<60)return`${r}m ago`;const i=Math.floor(r/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`};a.useEffect(()=>{const s=localStorage.getItem("recentSearches");s&&Y(JSON.parse(s))},[]);const ot=s=>{if(!s.trim())return;const r=[s,...J.filter(i=>i!==s)].slice(0,5);Y(r),localStorage.setItem("recentSearches",JSON.stringify(r))},nt=s=>{m(s),ot(s),st(!1)},[lt,ee]=a.useState(!1),[rs,as]=a.useState([]),[is,Se]=a.useState([]),se=a.useRef(null),ct=["iPhone 15","Toyota Hilux","Gaming Laptop","Sneakers","Apartments"],os=a.useRef(null),_e=a.useRef(null);a.useEffect(()=>{const s=d.get("category"),r=d.get("search"),i=d.get("q");s&&n(s),(r||i)&&m(r||i||"")},[d]),a.useEffect(()=>{document.title="Marketplace - Browse Products | SellHub",dt(),mt(),xt(),ht();const s=d.get("category"),r=d.get("search")||d.get("q");return s&&n(s),r&&m(r),ft(),()=>{_e.current&&clearInterval(_e.current)}},[]);const dt=()=>{_e.current=setInterval(()=>{ns()},3e4),ns()},ns=()=>{if(!navigator.onLine){ss(!0),Q("danger"),X(!0);return}if(ss(!1),window.location.protocol!=="https:"&&window.location.hostname!=="localhost"){Q("danger"),X(!0);return}const s=navigator.connection;s&&(s.effectiveType==="slow-2g"||s.effectiveType==="2g"?(Q("warning"),X(!0)):(Q("secure"),X(!1)))},mt=async()=>{try{const{data:{user:s}}=await l.auth.getUser();if(!s){Ye(null);return}const{data:r,error:i}=await l.from("profiles").select("*").eq("id",s.id).single();if(i)throw i;Ye(r),ut(s.id)}catch(s){console.error("Error loading user profile:",s)}},ut=async s=>{try{const{data:r,error:i}=await l.from("contact_sessions").select("*").eq("buyer_id",s).order("created_at",{ascending:!1}).limit(20);if(i)throw i;tt(r||[])}catch(r){console.error("Error loading contact history:",r)}},xt=async()=>{const s=me.counties.map(r=>({id:r.id,name:r.name}));et(s)},pt=s=>me.counties.find(i=>i.id===s||i.name===s)?.locations||[],ke=async()=>{try{Ve(!0);let s=l.from("products").select(`
        *,
        phone,
        whatsapp,
        email,
        profiles:user_id(
          id,
          full_name,
          avatar_url,
          rating,
          total_ratings,
          created_at,
          phone,
          whatsapp,
          username,
          updated_at
        )
        )
      `);switch(o&&(s=s.or(`name.ilike.%${o}%,description.ilike.%${o}%,category.ilike.%${o}%,county.ilike.%${o}%,location.ilike.%${o}%`)),u&&u!=="All"&&(s=s.eq("category",u)),S[0]>0&&(s=s.gte("price",S[0])),S[1]<1e6&&(s=s.lte("price",S[1])),v&&(s=s.ilike("county",`%${v}%`)),_&&(s=s.ilike("location",`%${_}%`)),b.length>0&&(s=s.in("condition",b)),M&&(s=s.eq("verified",!0)),O){case"lowest-price":s=s.order("price",{ascending:!0});break;case"highest-price":s=s.order("price",{ascending:!1});break;case"trending":s=s.order("featured",{ascending:!1}).order("created_at",{ascending:!1});break;default:s=s.order("created_at",{ascending:!1})}s=s.in("status",["active","approved"]).limit(100);const{data:r,error:i}=await s;if(i)throw i;if(r&&r.length>0){const c=r.filter(p=>p.verified),x=r.filter(p=>!p.verified),j=[...c,...x];N(j)}else N([])}catch(s){console.error("Error loading products:",s),A(s,"loading products")}finally{Ve(!1)}};a.useEffect(()=>{const s=setTimeout(()=>{ke()},500);return()=>clearTimeout(s)},[o,u,S,v,_,b,M]),a.useEffect(()=>{if(o.length>1){const s=De.filter(r=>r.toLowerCase().includes(o.toLowerCase())&&r!=="All").slice(0,5);as(s)}else as([])},[o]);const ht=async()=>{try{const{data:{user:s}}=await l.auth.getUser();if(!s)return;const{data:r,error:i}=await l.from("favorites").select("*").eq("user_id",s.id);if(i)throw i;const c=new Set(r?.map(x=>x.product_id)||[]);T(c),he(r||[])}catch(s){console.error("Error loading favorites:",s)}},gt=async(s,r)=>{try{const{data:{user:i}}=await l.auth.getUser();if(!i)return null;const{data:c,error:x}=await l.from("contact_sessions").select("*").eq("product_id",s).eq("buyer_id",i.id).eq("contact_type",r).gt("expires_at",new Date().toISOString()).maybeSingle();if(x)throw x;return c}catch(i){return console.error("Error checking contact session:",i),null}},ft=async()=>{try{const s=localStorage.getItem("recently_viewed")||"[]",r=JSON.parse(s);if(r.length===0){Se([]);return}const{data:i,error:c}=await l.from("products").select(`
          *,
          profiles:user_id(
            id,
            full_name,
            avatar_url,
            rating,
            total_ratings
          )
        `).in("id",r).in("status",["active","approved"]);if(c)throw c;const x=r.map(j=>i?.find(p=>p.id===j)).filter(Boolean);Se(x)}catch(s){console.error("Error loading recently viewed products:",s)}},ls=async(s,r)=>{r?.stopPropagation();try{const{data:{user:i}}=await l.auth.getUser();if(!i){g({variant:"destructive",title:"Sign in required",description:"Please sign in to add favorites"});return}const c=Ks.find(x=>x.product_id===s);if(c){const{error:x}=await l.from("favorites").delete().eq("id",c.id);if(x)throw x;T(j=>{const p=new Set(j);return p.delete(s),p}),he(j=>j.filter(p=>p.product_id!==s)),g({title:"Removed from favorites"})}else{const{data:x,error:j}=await l.from("favorites").insert({product_id:s,user_id:i.id}).select().single();if(j)throw j;T(p=>new Set(p).add(s)),he(p=>[...p,x]),g({title:"Added to favorites"})}}catch(i){console.error("Error toggling favorite:",i),A(i,"updating favorites")}},vt=async()=>{try{const{data:{user:s}}=await l.auth.getUser();if(!s||!t){g({variant:"destructive",title:"Sign in required",description:"Please sign in to submit a review"});return}if(!L.comment.trim()){g({variant:"destructive",title:"Comment required",description:"Please write a review comment"});return}Ge(!0);const{error:r}=await l.from("reviews").insert({reviewer_profile_id:s.id,product_id:t.id,rating:L.rating,comment:L.comment.trim()});if(r)throw r;g({title:"Review submitted successfully"}),fe({rating:5,comment:""}),cs(t.id)}catch(s){console.error("Error submitting review:",s),A(s,"submitting review")}finally{Ge(!1)}},yt=async s=>{try{const{data:{user:r}}=await l.auth.getUser();if(!r){g({variant:"destructive",title:"Sign in required",description:"Please sign in to mark reviews as helpful"});return}const{error:i}=await l.from("review_helpful").insert({review_id:s,user_id:r.id});if(i){if(i.code==="23505"){g({title:"Already marked as helpful"});return}throw i}He(c=>c.map(x=>x.id===s?{...x,helpful_count:x.helpful_count+1,is_helpful:!0}:x)),g({title:"Marked as helpful"})}catch(r){console.error("Error marking review helpful:",r),A(r,"marking review helpful")}},cs=async s=>{try{const{data:r,error:i}=await l.from("reviews").select(`
          *,
          profiles:reviewer_id (
            full_name,
            avatar_url
          )
        `).eq("product_id",s).order("created_at",{ascending:!1});if(i)throw i;const{data:{user:c}}=await l.auth.getUser();let x=new Set;if(c&&r){const{data:p,error:$}=await l.from("review_helpful").select("review_id").eq("user_id",c.id);!$&&p&&(x=new Set(p.map(Re=>Re.review_id)))}const j=r?.map(p=>({...p,is_helpful:x.has(p.id)}))||[];He(j)}catch(r){console.error("Error loading reviews:",r),A(r,"loading reviews")}},ds=async()=>{try{const{data:{user:s}}=await l.auth.getUser();if(!s||!t)return;if(!U.trim()){g({variant:"destructive",title:"Message cannot be empty"});return}We(!0);const{data:r,error:i}=await l.rpc("get_or_create_conversation",{p_user1_id:s.id,p_user2_id:t.user_id,p_product_id:t.id});if(i)throw console.error("Error creating conversation:",i),i;const{error:c}=await l.from("messages").insert({conversation_id:r,message_text:U.trim(),content:U.trim(),sender_id:s.id,receiver_id:t.user_id,product_id:t.id,product_name:t.name,product_price:t.price,product_image:t.images?.[0]||null,product_category:t.category,product_condition:t.condition,product_location:t.location,message_type:"text",is_system_message:!1});if(c)throw c;Be(""),ms(t.id),g({title:"Message sent successfully"})}catch(s){console.error("Error sending message:",s),A(s,"sending message")}finally{We(!1)}},ms=async s=>{try{const{data:{user:r}}=await l.auth.getUser();if(!r){g({variant:"destructive",title:"Sign in required",description:"Please sign in to view messages"});return}const{data:i,error:c}=await l.from("messages").select(`
        *,
        profiles:sender_id(
          full_name,
          avatar_url
        )
      `).eq("product_id",s).or(`sender_id.eq.${r.id},receiver_id.eq.${r.id}`).order("created_at",{ascending:!0});if(c)throw console.error("Error loading messages:",c),c;Gs(i||[])}catch(r){console.error("Error loading messages:",r),A(r,"loading messages")}},bt=async()=>{if(!t||!W.trim()){g({variant:"destructive",title:"Missing information",description:"Please select a reason for reporting"});return}try{es(!0);const{data:{user:s},error:r}=await l.auth.getUser();if(r||!s){g({variant:"destructive",title:"Sign in required",description:"Please sign in to submit a report"});return}const{data:i,error:c}=await l.from("profiles").select("id").eq("id",s.id).single();if(c||!i){g({variant:"destructive",title:"Profile Not Found",description:"Please complete your profile before submitting reports"});return}const{data:x,error:j}=await l.from("profiles").select("id").eq("id",t.user_id).single();if(j||!x){g({variant:"destructive",title:"Seller Profile Not Found",description:"Cannot report seller with incomplete profile"});return}const p={reporter_id:s.id,reported_id:t.user_id,reason:W,status:"pending",created_at:new Date().toISOString()};z.trim()&&(p.details=z),p.product_id=t.id;const{error:$}=await l.from("reports").insert(p);if($)if(console.error("Error submitting report:",$),$.code==="42703"||$.message.includes("column")){const Re={reporter_id:s.id,reported_id:t.user_id,reason:`${W}${z?` - ${z}`:""}`,status:"pending",created_at:new Date().toISOString()},{error:ps}=await l.from("reports").insert(Re);if(ps)throw ps}else throw $;g({title:"Report submitted",description:"Thank you for helping keep our community safe"}),ye(!1),Xe(""),Ze("")}catch(s){console.error("Error submitting report:",s),s.code==="23503"?s.message.includes("reports_resolved_by_fkey")?g({variant:"destructive",title:"System Configuration Error",description:"The reporting system is temporarily unavailable. Please try again later."}):s.message.includes("reports_reporter_id_fkey")?g({variant:"destructive",title:"Profile Error",description:"Your profile is not properly set up. Please update your profile and try again."}):g({variant:"destructive",title:"Data Error",description:"Could not submit report. Please contact support."}):A(s,"submitting report")}finally{es(!1)}},A=(s,r)=>{console.error(`Error in ${r}:`,s),s.code==="42501"?g({variant:"destructive",title:"Permission Denied",description:"You don't have permission to perform this action"}):s.code==="23503"?g({variant:"destructive",title:"Reference Error",description:"Related data not found. Please try again."}):s.code==="23505"?g({variant:"destructive",title:"Duplicate Entry",description:"This item already exists"}):s.code==="23502"?g({variant:"destructive",title:"Missing Information",description:"Please fill in all required fields"}):g({variant:"destructive",title:`Error in ${r}`,description:s.message||"An unexpected error occurred"})},te=s=>!s?.rating||!s?.total_ratings?null:{rating:s.rating,totalRatings:s.total_ratings},Ce=s=>new Date(s).toLocaleDateString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),us=async(s,r)=>{r?.stopPropagation(),R(s),Ys(null),Je&&await gt(s.id,"phone"),Te(!0)},jt=async(s,r)=>{R(s),Le(!0),await cs(s.id)},wt=async(s,r)=>{const{data:{user:i}}=await l.auth.getUser();if(!i){g({variant:"destructive",title:"Sign in required",description:"Please sign in to send messages"});return}R(s),Ue(!0),await ms(s.id)};a.useEffect(()=>{os.current?.scrollIntoView({behavior:"smooth"})},[ve]);const re=s=>{R(s),q(0),Z(!1),je(!0),vr(s.id),xs(s),setTimeout(()=>{se.current?.scrollTo({top:0,behavior:"smooth"})},100)},Nt=()=>{je(!1),Z(!1),q(0)},St=()=>{t?.images&&q(s=>s===0?t.images.length-1:s-1)},_t=()=>{t?.images&&q(s=>s===t.images.length-1?0:s+1)},kt=s=>{q(s),Z(!1)},Ct=()=>{Z(s=>!s)},xs=async s=>{try{const r=s.name.split(" ").filter(j=>j.length>3).slice(0,2);let i=l.from("products").select(`
          *,
          profiles:user_id(
            id,
            full_name,
            avatar_url,
            rating,
            total_ratings
          )
        `).neq("id",s.id).in("status",["active","approved"]);if(r.length>0){const j=r.map(p=>`name.ilike.%${p}%`).join(",");i=i.or(`category.eq."${s.category}",${j}`)}else i=i.eq("category",s.category);let{data:c,error:x}=await i.order("featured",{ascending:!1}).order("created_at",{ascending:!1}).limit(4);if(x)throw x;if(!c||c.length===0){const{data:j,error:p}=await l.from("products").select(`
            *,
            profiles:user_id(
              id,
              full_name,
              avatar_url,
              rating,
              total_ratings
            )
          `).neq("id",s.id).eq("category",s.category).in("status",["active","approved"]).order("created_at",{ascending:!1}).limit(4);if(p)throw p;c=j}setSimilarProducts(c||[])}catch(r){console.error("Error loading AI similar products:",r)}};a.useEffect(()=>{if(!Ne||!t?.images)return;const s=setInterval(()=>{q(r=>r===t.images.length-1?0:r+1)},3e3);return()=>clearInterval(s)},[Ne,t]);const Rt=()=>rt?e.jsx(pr,{className:"h-4 w-4"}):be==="danger"?e.jsx(gr,{className:"h-4 w-4 text-red-500"}):be==="warning"?e.jsx(fr,{className:"h-4 w-4 text-amber-500"}):e.jsx(hr,{className:"h-4 w-4 text-green-500"});return ze?e.jsx("main",{className:"container mx-auto py-4 sm:py-8 px-3 sm:px-4",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-sm sm:text-base",children:"Loading marketplace..."})]})})}):e.jsxs(e.Fragment,{children:[e.jsx(Xt,{title:"Marketplace - Browse Thousands of Products in Kenya",description:"Explore Kenya's largest online marketplace. Buy electronics, fashion, vehicles, and more with secure direct contact.",keywords:"Kenya marketplace, buy online Kenya, electronics Kenya, fashion Kenya",structuredData:{"@context":"https://schema.org","@type":"CollectionPage",name:"Secure Marketplace",description:"Safe online marketplace for buying and selling"}}),e.jsxs("main",{className:"min-h-screen bg-gradient-to-b from-gray-50 to-white",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-600 to-emerald-700 text-white py-4",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Secure Marketplace"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-white/10 rounded-md",children:[Rt(),e.jsx("span",{className:"text-xs",children:be==="secure"?"Secure":"Check Network"})]})})]})})}),e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-black mb-4 bg-gradient-to-r from-gray-900 to-green-700 bg-clip-text text-transparent",children:"Marketplace"}),e.jsx("p",{className:"text-gray-600 text-lg max-w-2xl mx-auto",children:"Discover amazing products from trusted sellers across Kenya"})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/20 p-4 sm:p-8 mb-12 sticky top-4 z-40",children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 w-full group",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-primary to-primary/60 rounded-2xl blur opacity-25 group-focus-within:opacity-50 transition duration-1000 group-hover:duration-200"}),e.jsxs("div",{className:"relative",children:[e.jsx(Pe,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-primary transition-colors"}),e.jsx(de,{placeholder:"What are you looking for today?",value:o,onChange:s=>m(s.target.value),onFocus:()=>ee(!0),onBlur:()=>setTimeout(()=>ee(!1),200),className:"pl-12 pr-4 py-6 text-lg border-2 border-gray-100/80 bg-gray-50/50 rounded-2xl focus-visible:ring-2 focus-visible:ring-primary/30 shadow-inner group-focus-within:border-primary/50 transition-all"})]}),lt&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-4 bg-white/90 backdrop-blur-2xl rounded-2xl shadow-2xl border border-white/20 z-50 overflow-hidden animate-in fade-in slide-in-from-top-4 duration-300",children:[J.length>0&&!o&&e.jsxs("div",{className:"p-4 border-b border-gray-100/50",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 uppercase tracking-[0.2em]",children:"Recent Searches"}),e.jsx(h,{variant:"ghost",size:"sm",className:"h-6 text-[10px] text-gray-400 hover:text-red-500",onClick:s=>{s.preventDefault(),localStorage.removeItem("recentSearches"),Y([])},children:"Clear"})]}),e.jsx("div",{className:"space-y-1",children:J.map((s,r)=>e.jsxs("button",{className:"w-full text-left px-4 py-3 hover:bg-gray-50 rounded-xl flex items-center justify-between group transition-colors",onClick:()=>nt(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ws,{className:"h-4 w-4 text-gray-400 group-hover:text-primary transition-colors"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:s})]}),e.jsx(Ut,{className:"h-4 w-4 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity p-0.5",onClick:i=>{i.stopPropagation();const c=J.filter(x=>x!==s);Y(c),localStorage.setItem("recentSearches",JSON.stringify(c))}})]},r))})]}),o.length>0&&rs.length>0&&e.jsxs("div",{className:"p-4 border-b border-gray-100/50",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 px-3 py-2 uppercase tracking-[0.2em]",children:"Suggested Categories"}),rs.map(s=>e.jsxs("button",{className:"w-full text-left px-4 py-3 hover:bg-primary/5 rounded-xl flex items-center gap-4 transition-all group",onClick:()=>{n(s),m(""),ee(!1)},children:[e.jsx("div",{className:"bg-primary/10 p-2.5 rounded-xl group-hover:bg-primary/20 transition-colors",children:e.jsx(H,{className:"h-4 w-4 text-primary"})}),e.jsx("span",{className:"font-bold text-gray-700",children:s})]},s))]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-[10px] font-black text-gray-400 px-3 py-2 uppercase tracking-[0.2em]",children:"Trending Now"}),e.jsx("div",{className:"flex flex-wrap gap-2 p-2",children:ct.map(s=>e.jsxs(h,{variant:"outline",size:"sm",className:"rounded-full border-gray-100 hover:border-primary hover:bg-primary/5 text-gray-600 px-4 font-bold text-xs",onClick:()=>{m(s),ke(),ee(!1)},children:[e.jsx(zt,{className:"h-3 w-3 mr-2 text-primary"}),s]},s))})]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full lg:w-auto",children:[e.jsxs(h,{onClick:ke,className:"bg-primary hover:bg-primary/90 text-white rounded-2xl h-14 px-8 flex items-center justify-center transition-all shadow-xl shadow-primary/20 hover:shadow-primary/30 active:scale-95",children:[e.jsx(Pe,{className:"h-5 w-5 mr-2"}),"Search"]}),e.jsx(h,{variant:"outline",className:"lg:hidden rounded-2xl h-14 w-14 p-0 border-2",onClick:()=>Js(!Ws),children:e.jsx(lr,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-5 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 col-span-1",children:[e.jsx(P,{className:"text-[10px] sm:text-xs font-bold text-gray-500 uppercase ml-1",children:"Category"}),e.jsx("select",{value:u,onChange:s=>n(s.target.value),className:"w-full h-10 sm:h-12 px-3 sm:px-4 rounded-xl bg-gray-50/50 border-2 border-gray-100/50 focus:border-primary/50 transition-all appearance-none outline-none text-xs sm:text-sm font-medium shadow-sm hover:border-primary/30",children:De.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 col-span-1",children:[e.jsx(P,{className:"text-[10px] sm:text-xs font-bold text-gray-500 uppercase ml-1",children:"County"}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{value:v,onChange:s=>{y(s.target.value),w("")},className:"w-full h-10 sm:h-12 px-3 sm:px-8 rounded-xl bg-gray-50/50 border-2 border-gray-100/50 focus:border-primary/50 transition-all appearance-none outline-none text-xs sm:text-sm font-medium shadow-sm hover:border-primary/30",children:[e.jsx("option",{value:"",children:"All Counties"}),Zs.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx(V,{className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 h-3 w-3 sm:h-4 sm:w-4 text-gray-400 pointer-events-none hidden sm:block group-focus-within:text-primary transition-colors"})]})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 col-span-2 lg:col-span-1",children:[e.jsx(P,{className:"text-[10px] sm:text-xs font-bold text-gray-500 uppercase ml-1",children:"Specific Area"}),e.jsxs("div",{className:"relative group",children:[e.jsxs("select",{value:_,onChange:s=>w(s.target.value),disabled:!v,className:"w-full h-10 sm:h-12 px-3 sm:px-8 rounded-xl bg-gray-50/50 border-2 border-gray-100/50 focus:border-primary/50 transition-all appearance-none outline-none text-xs sm:text-sm font-medium shadow-sm hover:border-primary/30 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("option",{value:"",children:v?"All Areas":"Select County first"}),v&&pt(v).map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(Pe,{className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 h-3 w-3 sm:h-4 sm:w-4 text-gray-400 pointer-events-none hidden sm:block group-focus-within:text-primary transition-colors"})]})]}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 col-span-1",children:[e.jsx(P,{className:"text-[10px] sm:text-xs font-bold text-gray-500 uppercase ml-1",children:"Sort"}),e.jsxs("select",{value:O,onChange:s=>pe(s.target.value),className:"w-full h-10 sm:h-12 px-3 sm:px-4 rounded-xl bg-gray-50/50 border-2 border-gray-100/50 focus:border-primary/50 transition-all appearance-none outline-none text-xs sm:text-sm font-medium shadow-sm hover:border-primary/30",children:[e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"lowest-price",children:"Price: Low"}),e.jsx("option",{value:"highest-price",children:"Price: High"}),e.jsx("option",{value:"trending",children:"Trending"})]})]}),e.jsx("div",{className:"flex items-end gap-2 col-span-1 lg:col-span-1",children:e.jsxs(h,{variant:"outline",className:"h-10 sm:h-12 w-full rounded-xl border-2 p-0 flex items-center justify-center gap-2 text-[10px] sm:text-xs font-bold uppercase",onClick:()=>{C([0,1e6]),y(""),w(""),E([]),G(!1),n("All"),m("")},title:"Reset All",children:[e.jsx(Fe,{className:"h-3 w-3 sm:h-4 sm:w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Reset"})]})})]})]}),is.length>0&&e.jsxs("div",{className:"mb-12 animate-in fade-in slide-in-from-bottom-4 duration-700 delay-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-xl",children:e.jsx(ws,{className:"h-5 w-5 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-gray-900 tracking-tight",children:"Recently Viewed"}),e.jsx("p",{className:"text-gray-500 text-sm font-medium",children:"Items you've explored recently"})]})]}),e.jsx(h,{variant:"ghost",size:"sm",className:"text-indigo-600 hover:text-indigo-700 hover:bg-indigo-50 font-bold",onClick:()=>{localStorage.removeItem("recently_viewed"),Se([])},children:"Clear History"})]}),e.jsx(er,{className:"w-full whitespace-nowrap rounded-2xl pb-4",children:e.jsx("div",{className:"flex gap-6",children:is.map(s=>e.jsxs("div",{className:"w-72 shrink-0 group cursor-pointer",onClick:()=>re(s),children:[e.jsxs("div",{className:"relative aspect-[4/3] rounded-2xl overflow-hidden mb-4 shadow-md group-hover:shadow-xl transition-all duration-300",children:[e.jsx("img",{src:s.images?.[0]||"/placeholder.svg",alt:s.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute bottom-3 left-3 right-3 flex justify-between items-end opacity-0 group-hover:opacity-100 transition-opacity translate-y-2 group-hover:translate-y-0 duration-300",children:e.jsx(I,{className:"bg-white/90 text-gray-900 border-0 backdrop-blur-md",children:"View Now"})})]}),e.jsx("h3",{className:"font-bold text-gray-900 truncate mb-1 group-hover:text-indigo-600 transition-colors",children:s.name}),e.jsxs("p",{className:"text-indigo-600 font-black text-lg",children:["KES ",s.price?.toLocaleString()]})]},`recent-${s.id}`))})}),e.jsx(sr,{className:"mt-8"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"hidden lg:block lg:col-span-1",children:e.jsx(Pr,{categories:De,selectedCategory:u,onCategoryChange:n,priceRange:S,onPriceRangeChange:C,conditions:b,onConditionChange:s=>{b.includes(s)?E(b.filter(r=>r!==s)):E([...b,s])},verifiedOnly:M,onVerifiedChange:G,selectedCounty:v,onCountyChange:y,selectedNeighborhood:_,onNeighborhoodChange:w})}),e.jsx("div",{className:"lg:col-span-3",children:ze?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((s,r)=>e.jsxs(gs,{className:"overflow-hidden border-0 shadow-lg rounded-2xl bg-white/50 backdrop-blur-sm animate-pulse",children:[e.jsx(D,{className:"h-64 w-full rounded-t-2xl"}),e.jsxs(Vt,{className:"pb-3 px-6 pt-6",children:[e.jsx(D,{className:"h-7 w-3/4 mb-2"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(D,{className:"h-5 w-20"}),e.jsx(D,{className:"h-5 w-24"})]})]}),e.jsxs(Ht,{className:"pb-4 px-6",children:[e.jsx(D,{className:"h-8 w-1/2 mb-3"}),e.jsx(D,{className:"h-4 w-full mb-2"}),e.jsx(D,{className:"h-4 w-2/3"})]}),e.jsxs(Kt,{className:"gap-3 pt-0 px-6 pb-6",children:[e.jsx(D,{className:"h-10 flex-1 rounded-xl"}),e.jsx(D,{className:"h-10 flex-1 rounded-xl"})]})]},r))}):f.length===0?e.jsxs("div",{className:"text-center py-16 bg-white rounded-2xl shadow-lg border border-gray-200",children:[e.jsx(ce,{className:"h-20 w-20 text-gray-400 mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-bold mb-4 text-gray-700",children:f.length===0?"Marketplace is Empty":"No Products Found"}),e.jsx("p",{className:"text-gray-600 mb-8 max-w-md mx-auto",children:o||u!=="All"?"Try adjusting your search terms or browse different categories":"Be the first to list a product and start selling today!"}),f.length===0&&e.jsx(Gt,{to:"/products/upload",children:e.jsxs(h,{size:"lg",className:"bg-green-600 hover:bg-green-700 px-8 py-3 rounded-xl",children:[e.jsx(H,{className:"w-5 h-5 mr-2"}),"List Your First Product"]})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:f.map(s=>{te(s.profiles);const r=B.has(s.id);return e.jsxs(gs,{className:"group relative overflow-hidden bg-white hover:shadow-[0_32px_64px_-12px_rgba(0,0,0,0.14)] transition-all duration-700 border-none rounded-[2rem] h-full flex flex-col",onClick:()=>re(s),children:[e.jsxs("div",{className:"relative aspect-[4/5] overflow-hidden m-2 rounded-[1.5rem] shadow-sm",children:[s.images?.[0]?e.jsx("img",{src:s.images[0],className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000 ease-out"}):e.jsx("div",{className:"w-full h-full bg-gray-100 flex items-center justify-center",children:e.jsx(ce,{className:"h-12 w-12 text-gray-300"})}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/60 to-transparent opacity-60 group-hover:h-full transition-all duration-700"}),e.jsx("div",{className:"absolute inset-0 bg-primary/10 opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex justify-between items-start pointer-events-none",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[s.verified&&e.jsxs(I,{className:"bg-white/90 backdrop-blur-md text-primary shadow-xl border-none font-bold py-1.5 px-3 rounded-full animate-in slide-in-from-left duration-500",children:[e.jsx(cr,{className:"h-3.5 w-3.5 mr-1.5"}),"Verified"]}),s.featured&&e.jsxs(I,{className:"bg-amber-400 text-white border-none font-bold py-1.5 px-3 rounded-full shadow-lg",children:[e.jsx(H,{className:"h-3.5 w-3.5 mr-1.5"}),"Elite"]}),s.original_price&&s.original_price>s.price&&e.jsxs(I,{className:"bg-orange-500 text-white border-none font-bold py-1.5 px-3 rounded-full shadow-lg animate-pulse",children:[e.jsx(dr,{className:"h-3.5 w-3.5 mr-1.5"}),"Price Drop"]})]}),e.jsx(h,{size:"icon",variant:"ghost",className:`h-11 w-11 rounded-full backdrop-blur-md pointer-events-auto transition-all duration-300 ${r?"bg-red-500 text-white":"bg-white/20 text-white hover:bg-white/40"}`,onClick:i=>ls(s.id,i),children:e.jsx(fs,{className:`h-5 w-5 ${r?"fill-white":""}`})})]}),e.jsxs("div",{className:"absolute bottom-6 left-6 right-6 translate-y-4 group-hover:translate-y-0 opacity-0 group-hover:opacity-100 transition-all duration-500 h-12 flex gap-2",children:[e.jsx(h,{className:"flex-1 bg-white text-black hover:bg-gray-100 rounded-xl h-full font-bold shadow-xl shadow-black/20",onClick:i=>us(s,i),children:"Contact"}),e.jsx(h,{size:"icon",className:"w-12 h-full bg-white/20 backdrop-blur-md rounded-xl text-white hover:bg-white/30",onClick:()=>re(s),children:e.jsx(Ns,{className:"h-5 w-5"})})]})]}),e.jsxs("div",{className:"p-6 flex-1 flex flex-col gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-primary mb-1 block",children:s.category}),s.condition==="new"&&e.jsx(I,{className:"bg-primary/10 text-primary border-none text-[10px] h-5",children:"NEW"})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 line-clamp-1 group-hover:text-primary transition-colors",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-2 line-clamp-2 leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-bold uppercase tracking-wider",children:"Price"}),s.original_price&&s.original_price>s.price&&e.jsxs("span",{className:"text-[10px] text-gray-400 line-through font-medium",children:["KES ",s.original_price.toLocaleString()]})]}),e.jsx(tr,{kesAmount:s.price||0,className:"text-2xl font-black text-gray-900"})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.profiles?.avatar_url?e.jsxs("div",{className:"relative",children:[e.jsxs(Ee,{className:"h-6 w-6 border border-gray-100",children:[e.jsx(Me,{src:s.profiles.avatar_url,alt:s.profiles.full_name||"Seller"}),e.jsx(Ie,{children:(s.profiles.full_name||"S").charAt(0)})]}),e.jsx("span",{className:`absolute -bottom-0.5 -right-0.5 w-2 h-2 rounded-full border border-white ${ts(s.profiles.updated_at)?"bg-green-500":"bg-gray-300"}`})]}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-gradient-to-r from-gray-100 to-gray-200 flex items-center justify-center border border-gray-100",children:e.jsx(vs,{className:"h-3.5 w-3.5 text-gray-500"})}),e.jsx("span",{className:`absolute -bottom-0.5 -right-0.5 w-2 h-2 rounded-full border border-white ${ts(s.profiles?.updated_at)?"bg-green-500":"bg-gray-300"}`})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-[10px] font-medium text-gray-700 max-w-[80px] truncate",children:s.profiles?.full_name||"Seller"}),e.jsx("span",{className:"text-[8px] text-gray-400",children:it(s.profiles?.updated_at)})]})]}),e.jsxs("div",{className:"flex items-center text-gray-500 text-[10px] font-bold bg-gray-50 px-2 py-1 rounded-lg mt-1",children:[e.jsx(V,{className:"h-3 w-3 mr-1 text-secondary"}),s.location?.split(",")[0]]})]})]}),e.jsxs("div",{className:"flex gap-2 w-full mt-4",children:[e.jsxs(h,{variant:"outline",className:"flex-1 border-primary/20 hover:border-primary hover:bg-primary/5 text-primary rounded-2xl h-12 font-bold transition-all active:scale-95",onClick:i=>{i.stopPropagation(),re(s)},children:[e.jsx(Ns,{className:"h-4 w-4 mr-2"}),"View"]}),e.jsxs(h,{className:"flex-1 bg-secondary hover:bg-secondary/90 text-white rounded-2xl h-12 font-bold transition-all hover:shadow-[0_8px_20px_-6px_rgba(255,102,0,0.4)] active:scale-95",onClick:i=>{i.stopPropagation(),k(s)},children:[e.jsx(ys,{className:"h-4 w-4 mr-2"}),"Quick Add"]})]})]})]},s.id)})})})]})]}),e.jsx(rr,{open:F,onOpenChange:Te,sellerProfile:Qe?{full_name:t?.profiles?.full_name||"Seller",username:"Seller",phone:Qe.revealed_contact,profile_image:t?.profiles?.avatar_url||""}:{full_name:t?.profiles?.full_name||"Seller",username:"Seller",phone:t?.phone||t?.profiles?.phone||"",whatsapp:t?.whatsapp||t?.profiles?.whatsapp||"",profile_image:t?.profiles?.avatar_url||""},product:{name:t?.name||"",price:t?.price||0,currency:"KES"}}),e.jsx(ae,{open:Qs,onOpenChange:ye,children:e.jsxs(ie,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsx(ne,{children:"Report Seller"}),e.jsx(le,{children:"Help us keep the marketplace safe"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Reason for reporting"}),e.jsxs("select",{className:"w-full p-2 border rounded-lg mt-1",value:W,onChange:s=>Xe(s.target.value),children:[e.jsx("option",{value:"",children:"Select a reason"}),e.jsx("option",{value:"fake_product",children:"Fake product"}),e.jsx("option",{value:"suspicious",children:"Suspicious activity"}),e.jsx("option",{value:"harassment",children:"Harassment"}),e.jsx("option",{value:"spam",children:"Spam"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx(P,{children:"Details (optional)"}),e.jsx(js,{placeholder:"Please provide more details...",value:z,onChange:s=>Ze(s.target.value),className:"mt-1"})]})]}),e.jsxs(Zt,{children:[e.jsx(h,{variant:"outline",onClick:()=>ye(!1),children:"Cancel"}),e.jsx(h,{onClick:bt,disabled:Xs,children:"Submit Report"})]})]})}),e.jsx(ae,{open:at,onOpenChange:Nt,children:e.jsx(ie,{className:"max-w-[95vw] sm:max-w-3xl md:max-w-4xl max-h-[90vh] overflow-y-auto",ref:se,children:t&&e.jsxs("div",{className:"animate-in fade-in duration-500",children:[e.jsxs(oe,{children:[e.jsx(ne,{className:"text-xl sm:text-2xl",children:t.name}),e.jsxs(le,{className:"flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-4 text-sm sm:text-base",children:[e.jsx("span",{className:"capitalize",children:t.category}),t.subcategory&&e.jsxs("span",{className:"text-primary hidden sm:inline",children:["â€¢ ",t.subcategory]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-muted",children:t.images&&t.images.length>0?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.images[we],alt:t.name,className:"w-full h-full object-cover"}),t.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"icon",variant:"secondary",className:"absolute left-2 top-1/2 -translate-y-1/2 bg-background/80 backdrop-blur-sm hover:bg-background h-8 w-8 sm:h-10 sm:w-10",onClick:St,children:e.jsx(Bt,{className:"h-4 w-4"})}),e.jsx(h,{size:"icon",variant:"secondary",className:"absolute right-2 top-1/2 -translate-y-1/2 bg-background/80 backdrop-blur-sm hover:bg-background h-8 w-8 sm:h-10 sm:w-10",onClick:_t,children:e.jsx(Wt,{className:"h-4 w-4"})}),e.jsx(h,{size:"icon",variant:"secondary",className:"absolute top-2 right-2 bg-background/80 backdrop-blur-sm hover:bg-background h-8 w-8 sm:h-10 sm:w-10",onClick:Ct,children:Ne?e.jsx(Jt,{className:"h-4 w-4"}):e.jsx(Yt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 bg-background/80 backdrop-blur-sm px-2 sm:px-3 py-1 rounded-full text-xs sm:text-sm",children:[we+1," /"," ",t.images.length]})]})]}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(ce,{className:"h-12 w-12 sm:h-16 sm:w-16 text-muted-foreground"})})}),t.images&&t.images.length>1&&e.jsx("div",{className:"grid grid-cols-4 gap-2",children:t.images.map((s,r)=>e.jsx("div",{className:`aspect-square rounded-md overflow-hidden bg-muted cursor-pointer border-2 transition-all ${r===we?"border-primary":"border-transparent"}`,onClick:()=>kt(r),children:e.jsx("img",{src:s,alt:`${t.name} view ${r+1}`,className:"w-full h-full object-cover"})},r))})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl sm:text-3xl font-bold text-primary",children:["KES ",t.price?.toLocaleString()]}),t.original_price&&t.original_price>t.price&&e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-base sm:text-lg text-muted-foreground line-through",children:["KES"," ",t.original_price.toLocaleString()]}),e.jsxs(I,{variant:"destructive",className:"text-xs",children:["Save"," ",Math.round((1-t.price/t.original_price)*100),"%"]})]}),t.is_negotiable&&e.jsx(I,{variant:"secondary",className:"mt-2 text-xs",children:"Price Negotiable"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2 text-sm sm:text-base",children:"Description"}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-line text-sm sm:text-base",children:t.description||"No description provided."})]}),t.properties&&Object.keys(t.properties).length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2 text-sm sm:text-base",children:"Specifications"}),e.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 gap-2",children:Object.entries(t.properties).map(([s,r])=>e.jsxs("div",{className:"flex justify-between border-b pb-1",children:[e.jsxs("span",{className:"text-xs sm:text-sm font-medium",children:[s,":"]}),e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground capitalize",children:String(r)})]},s))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs sm:text-sm font-medium mb-1",children:"Condition"}),e.jsx(I,{variant:"outline",className:"capitalize text-xs",children:t.condition?.replace(/-/g," ")||"Not specified"})]}),t.location&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs sm:text-sm font-medium mb-1",children:"Location"}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground flex items-center",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),t.location]})]})]}),t.profiles&&e.jsxs("div",{className:"border-t pt-3 sm:pt-4",children:[e.jsxs("h3",{className:"font-semibold mb-2 sm:mb-3 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(vs,{className:"h-4 w-4"}),"Seller Information"]}),e.jsxs("div",{className:"space-y-1 sm:space-y-2",children:[e.jsx("p",{className:"font-medium text-sm sm:text-base",children:t.profiles.full_name||"Seller"}),te(t.profiles)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-3 w-3 sm:h-4 sm:w-4 fill-yellow-400 text-yellow-400"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium",children:te(t.profiles)?.rating.toFixed(1)}),e.jsxs("span",{className:"text-xs sm:text-sm text-muted-foreground",children:["(",te(t.profiles)?.totalRatings," ","reviews)"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center",children:[e.jsx(mr,{className:"h-3 w-3 mr-1"}),"Listed ",Ce(t.created_at)]})]})]}),e.jsxs("div",{className:"flex flex-col xs:flex-row gap-2 sm:gap-3 pt-3 sm:pt-4",children:[e.jsxs(h,{size:"sm",className:"flex-1 bg-primary hover:bg-primary/90 text-white text-xs sm:text-sm h-9 sm:h-10",onClick:()=>{je(!1),us(t)},children:[e.jsx(Qt,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Contact Seller"]}),e.jsxs(h,{variant:"outline",size:"sm",className:"flex-1 border-primary/20 hover:border-primary hover:bg-primary/5 text-primary text-xs sm:text-sm h-9 sm:h-10",onClick:()=>wt(t),children:[e.jsx(bs,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Message"]}),e.jsxs(h,{size:"sm",className:"flex-1 bg-secondary hover:bg-secondary/90 text-white text-xs sm:text-sm h-9 sm:h-10 border-none shadow-lg shadow-secondary/20",onClick:()=>k(t),children:[e.jsx(ys,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"Add to Cart"]}),e.jsx(h,{size:"icon",variant:"outline",className:"h-9 w-9 sm:h-10 sm:w-10",onClick:s=>{s.stopPropagation(),ls(t.id)},children:e.jsx(fs,{className:`h-4 w-4 ${B.has(t.id)?"fill-red-500 text-red-500":""}`})})]}),e.jsxs(h,{variant:"outline",size:"sm",className:"w-full text-xs sm:text-sm h-9 sm:h-10",onClick:()=>jt(t),children:[e.jsx(K,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-2"}),"View Reviews"]}),similarProducts.length>0&&e.jsxs("div",{className:"pt-6 border-t mt-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("h3",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 p-1.5 rounded-lg",children:e.jsx(H,{className:"h-5 w-5 text-primary animate-pulse"})}),"Smart Recommendations",e.jsx(I,{className:"bg-gradient-to-r from-primary to-primary/60 text-[10px] uppercase h-5 border-none",children:"AI Driven"})]})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:similarProducts.map(s=>e.jsxs("div",{className:"group cursor-pointer bg-gray-50 rounded-xl p-2 border border-transparent hover:border-primary/20 hover:bg-primary/5 transition-all",onClick:()=>{R(s),q(0),xs(s),se.current&&se.current.scrollTo({top:0,behavior:"smooth"})},children:[e.jsxs("div",{className:"aspect-square rounded-lg overflow-hidden mb-2 relative",children:[s.images&&s.images.length>0?e.jsx("img",{src:s.images[0],alt:s.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:e.jsx(ce,{className:"h-8 w-8 text-gray-400"})}),e.jsx("div",{className:"absolute bottom-1 right-1",children:e.jsxs(I,{className:"bg-primary text-[10px] px-1.5 py-0 h-4 border-none",children:["KES ",s.price?.toLocaleString()]})})]}),e.jsx("h4",{className:"text-xs font-semibold truncate group-hover:text-green-700 transition-colors",children:s.name}),e.jsxs("p",{className:"text-[10px] text-gray-500 flex items-center gap-1 mt-0.5",children:[e.jsx(V,{className:"h-2 w-2"}),s.location]})]},s.id))})]})]})]})]})})}),e.jsx(ae,{open:Vs,onOpenChange:Le,children:e.jsxs(ie,{className:"max-w-[95vw] sm:max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(ne,{className:"text-lg sm:text-xl",children:"Product Reviews"}),e.jsxs(le,{className:"text-sm sm:text-base",children:[t?.name," - Customer Reviews & Ratings"]})]}),t&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"border rounded-lg p-3 sm:p-4",children:[e.jsx("h3",{className:"font-semibold mb-2 sm:mb-3 text-sm sm:text-base",children:"Add Your Review"}),e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium",children:"Rating"}),e.jsx("div",{className:"flex gap-1 mt-1",children:[1,2,3,4,5].map(s=>e.jsx(h,{type:"button",variant:"ghost",size:"icon",onClick:()=>fe(r=>({...r,rating:s})),className:"h-7 w-7 sm:h-8 sm:w-8 p-0",children:e.jsx(K,{className:`h-4 w-4 sm:h-5 sm:w-5 ${s<=L.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs sm:text-sm font-medium",children:"Review"}),e.jsx(js,{placeholder:"Share your experience with this product...",value:L.comment,onChange:s=>fe(r=>({...r,comment:s.target.value})),className:"mt-1 text-sm",rows:3})]}),e.jsx(h,{size:"sm",onClick:vt,disabled:Ke||!L.comment.trim(),className:"w-full text-xs sm:text-sm h-9 sm:h-10",children:Ke?"Submitting...":"Submit Review"})]})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("h3",{className:"font-semibold text-sm sm:text-base",children:["Customer Reviews (",ge.length,")"]}),ge.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-6 sm:py-8 text-sm sm:text-base",children:"No reviews yet. Be the first to review this product!"}):ge.map(s=>e.jsxs("div",{className:"border rounded-lg p-3 sm:p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ee,{className:"h-7 w-7 sm:h-8 sm:w-8",children:[e.jsx(Me,{src:s.profiles.avatar_url}),e.jsx(Ie,{className:"text-xs",children:s.profiles.full_name?.[0]?.toUpperCase()||"U"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-xs sm:text-sm",children:s.profiles.full_name||"Anonymous"}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(r=>e.jsx(K,{className:`h-2 w-2 sm:h-3 sm:w-3 ${r<=s.rating?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},r))})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Ce(s.created_at)})]}),e.jsx("p",{className:"text-xs sm:text-sm mb-2 sm:mb-3",children:s.comment}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:()=>yt(s.id),disabled:s.is_helpful,className:"h-7 px-2 text-xs",children:[e.jsx(ur,{className:`h-3 w-3 mr-1 ${s.is_helpful?"fill-blue-500 text-blue-500":""}`}),"Helpful (",s.helpful_count,")"]})]},s.id))]})]})]})}),e.jsx(ae,{open:Hs,onOpenChange:Ue,children:e.jsxs(ie,{className:"max-w-[95vw] sm:max-w-2xl h-[80vh] flex flex-col",children:[e.jsxs(oe,{children:[e.jsx(ne,{className:"text-lg sm:text-xl",children:"Chat with Seller"}),e.jsxs(le,{className:"text-sm sm:text-base",children:[t?.name," - ",t?.profiles?.full_name]}),t&&e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 border rounded-lg bg-muted/50",children:[t.images&&t.images.length>0&&e.jsx("img",{src:t.images[0],alt:t.name,className:"w-10 h-10 sm:w-12 sm:h-12 rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-xs sm:text-sm",children:t.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-primary font-semibold",children:["KES ",t.price?.toLocaleString()]}),e.jsxs("div",{className:"flex flex-wrap gap-1 text-xs text-muted-foreground",children:[e.jsx("span",{className:"capitalize",children:t.category}),t.condition&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{className:"capitalize",children:t.condition.replace(/-/g," ")})]}),t.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),t.location]})]})]})]})]})]}),t&&e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-3 sm:space-y-4 mb-3 sm:mb-4 p-3 sm:p-4 border rounded-lg",children:[ve.length===0?e.jsxs("div",{className:"text-center text-muted-foreground py-6 sm:py-8",children:[e.jsx(bs,{className:"h-8 w-8 sm:h-10 sm:w-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No messages yet. Start a conversation!"})]}):ve.map(s=>{const r=s.sender_id===Je?.id;return e.jsxs("div",{className:`flex gap-2 sm:gap-3 ${r?"flex-row-reverse":""}`,children:[e.jsxs(Ee,{className:"h-7 w-7 sm:h-8 sm:w-8",children:[e.jsx(Me,{src:s.profiles.avatar_url}),e.jsx(Ie,{className:"text-xs",children:s.profiles.full_name?.[0]?.toUpperCase()||"U"})]}),e.jsxs("div",{className:`flex-1 ${r?"text-right":""}`,children:[e.jsx("div",{className:`inline-block px-3 py-2 rounded-lg max-w-[85%] text-xs sm:text-sm ${r?"bg-primary text-primary-foreground":"bg-muted"}`,children:e.jsx("p",{children:s.content})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Ce(s.created_at)})]})]},s.id)}),e.jsx("div",{ref:os})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(de,{placeholder:"Type your message...",value:U,onChange:s=>Be(s.target.value),onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),ds())},className:"text-sm"}),e.jsx(h,{onClick:ds,disabled:Bs||!U.trim(),size:"icon",className:"h-9 w-9 sm:h-10 sm:w-10",children:e.jsx(xr,{className:"h-4 w-4"})})]})]})]})})]})]})]})}export{ua as default};
