import{r as n,s as o,j as e,B as r,a7 as O,d as y,b as i,e as l,aX as F,b2 as G,b3 as v,x as m,y as x,t as H,aV as u,aB as U,av as z,f as M,b0 as V,D as X,b1 as J}from"./index-DIxCcwTo.js";import{T as W,a as K,b as S,c,d as Q,e as d}from"./table-B0i20-nK.js";import{U as Y}from"./users-DBPXf3v8.js";import{A as Z}from"./activity-B3fA73-G.js";import{G as $}from"./globe-CnvpoBT7.js";import{E as ee}from"./eye-DkAcDlvf.js";function ce(){const[t,_]=n.useState({totalLogins:0,failedAttempts:0,blockedIPs:0,activeSessions:0,securityScore:0,threatsDetected:0}),[w,A]=n.useState([]),[g,L]=n.useState([]),[D,C]=n.useState(!0);n.useEffect(()=>{h();const s=setInterval(h,3e4);return()=>clearInterval(s)},[]);const h=async()=>{try{const[s,f,T,k,E]=await Promise.all([o.from("admin_login_attempts").select("*").gte("created_at",new Date(Date.now()-864e5).toISOString()),o.from("admin_actions").select("*").eq("action_type","ip_blocked").gte("created_at",new Date(Date.now()-6048e5).toISOString()),o.from("admin_sessions").select("*").eq("is_revoked",!1).gt("expires_at",new Date().toISOString()),o.from("admin_actions").select("*").eq("resource_type","security").order("created_at",{ascending:!1}).limit(50),o.from("admin_actions").select("*").eq("resource_type","security").order("created_at",{ascending:!1}).limit(100)]),R=s.data?.filter(a=>a.success).length||0,N=s.data?.filter(a=>!a.success).length||0,j=E.data?.filter(a=>{const b=a.details?.severity;return b==="high"||b==="critical"})||[],P=Math.max(0,100-N*2-(j.length||0)*5);_({totalLogins:R,failedAttempts:N,blockedIPs:f.data?.length||0,activeSessions:T.data?.length||0,securityScore:P,threatsDetected:j.length||0});const B=(k.data||[]).map(a=>({id:a.id,admin_email:a.details?.admin_email||"System",action_type:a.action_type,severity:a.details?.severity||"low",ip_address:a.details?.ip_address||"N/A",created_at:a.created_at,details:a.details})),q=j.map(a=>({id:a.id,admin_email:a.details?.admin_email,action_type:a.action_type,severity:a.details?.severity,ip_address:a.details?.ip_address,created_at:a.created_at,details:a.details}));A(B),L(q.slice(0,20))}catch(s){console.error("Error loading security data:",s)}finally{C(!1)}},I=s=>{switch(s){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-blue-500";default:return"bg-gray-500"}},p=s=>({admin_login:"Admin Login",admin_logout:"Admin Logout",ip_blocked:"IP Blocked",auth_failed:"Auth Failed",suspicious_request:"Suspicious Request",admin_access_granted:"Access Granted","2fa_success":"2FA Success",unauthorized_admin_access:"Unauthorized Access"})[s]||s.replace(/_/g," ");return D?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Loading security dashboard..."})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50/30 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-br from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Security Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Real-time monitoring and threat detection"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(r,{variant:"outline",onClick:h,children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(y,{variant:t.securityScore>80?"default":t.securityScore>60?"secondary":"destructive",children:["Security Score: ",t.securityScore,"/100"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(i,{className:"bg-gradient-to-br from-blue-500 to-blue-600 text-white",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-100 text-sm font-medium",children:"Active Sessions"}),e.jsx("p",{className:"text-2xl font-bold",children:t.activeSessions}),e.jsx("p",{className:"text-blue-200 text-xs",children:"Currently logged in"})]}),e.jsx(Y,{className:"h-8 w-8 text-blue-200"})]})})}),e.jsx(i,{className:"bg-gradient-to-br from-green-500 to-green-600 text-white",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-green-100 text-sm font-medium",children:"Successful Logins"}),e.jsx("p",{className:"text-2xl font-bold",children:t.totalLogins}),e.jsx("p",{className:"text-green-200 text-xs",children:"Last 24 hours"})]}),e.jsx(F,{className:"h-8 w-8 text-green-200"})]})})}),e.jsx(i,{className:"bg-gradient-to-br from-red-500 to-red-600 text-white",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-red-100 text-sm font-medium",children:"Failed Attempts"}),e.jsx("p",{className:"text-2xl font-bold",children:t.failedAttempts}),e.jsx("p",{className:"text-red-200 text-xs",children:"Last 24 hours"})]}),e.jsx(G,{className:"h-8 w-8 text-red-200"})]})})}),e.jsx(i,{className:"bg-gradient-to-br from-orange-500 to-orange-600 text-white",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-orange-100 text-sm font-medium",children:"Threats Detected"}),e.jsx("p",{className:"text-2xl font-bold",children:t.threatsDetected}),e.jsx("p",{className:"text-orange-200 text-xs",children:"Recent activity"})]}),e.jsx(v,{className:"h-8 w-8 text-orange-200"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs(i,{className:"lg:col-span-2",children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Security Score Breakdown"]})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Overall Security"}),e.jsxs("span",{className:"text-sm font-bold",children:[t.securityScore,"%"]})]}),e.jsx(u,{value:t.securityScore,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Login Success Rate"}),e.jsxs("span",{className:"text-sm font-bold",children:[t.totalLogins+t.failedAttempts>0?Math.round(t.totalLogins/(t.totalLogins+t.failedAttempts)*100):100,"%"]})]}),e.jsx(u,{value:t.totalLogins+t.failedAttempts>0?t.totalLogins/(t.totalLogins+t.failedAttempts)*100:100,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Session Health"}),e.jsx("span",{className:"text-sm font-bold",children:t.activeSessions>0?"Good":"No Active"})]}),e.jsx(u,{value:t.activeSessions>0?100:0,className:"h-2"})]})]})]})})]}),e.jsxs(i,{children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Security Actions"]})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(r,{className:"w-full justify-start",variant:"outline",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Force Logout All Sessions"]}),e.jsxs(r,{className:"w-full justify-start",variant:"outline",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Update IP Whitelist"]}),e.jsxs(r,{className:"w-full justify-start",variant:"outline",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"View Audit Logs"]}),e.jsxs(r,{className:"w-full justify-start",variant:"outline",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Run Security Scan"]})]})})]})]}),e.jsxs(i,{className:"mb-8",children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Recent Security Events"]})}),e.jsx(l,{children:e.jsxs(W,{children:[e.jsx(K,{children:e.jsxs(S,{children:[e.jsx(c,{children:"Time"}),e.jsx(c,{children:"Admin"}),e.jsx(c,{children:"Action"}),e.jsx(c,{children:"Severity"}),e.jsx(c,{children:"IP Address"}),e.jsx(c,{children:"Details"})]})}),e.jsx(Q,{children:w.map(s=>e.jsxs(S,{children:[e.jsxs(d,{children:[e.jsx("div",{className:"text-sm",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleTimeString()})]}),e.jsx(d,{children:e.jsx("div",{className:"text-sm font-medium",children:s.admin_email})}),e.jsx(d,{children:e.jsx("span",{className:"text-sm",children:p(s.action_type)})}),e.jsx(d,{children:e.jsx(y,{className:I(s.severity),children:s.severity})}),e.jsx(d,{children:e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:s.ip_address})}),e.jsx(d,{children:e.jsx(r,{variant:"ghost",size:"sm",children:"View"})})]},s.id))})]})})]}),g.length>0&&e.jsxs(i,{className:"border-red-200",children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(v,{className:"h-5 w-5"}),"Suspicious Activity Detected"]})}),e.jsx(l,{children:e.jsx("div",{className:"space-y-3",children:g.map(s=>e.jsxs(V,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs(J,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:p(s.action_type)}),e.jsx("span",{className:"text-sm",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"text-sm mt-1",children:["IP: ",s.ip_address," â€¢ Admin:"," ",s.admin_email]}),s.details&&e.jsx("div",{className:"text-xs mt-2 bg-red-50 p-2 rounded",children:JSON.stringify(s.details,null,2)})]})]},s.id))})})]})]})})}export{ce as default};
