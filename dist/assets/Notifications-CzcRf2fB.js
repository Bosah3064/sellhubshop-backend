import{r as o,al as a,s as u,az as g,j as e,q as P,D as ce,B as b,a7 as C,d as A,aa as F,ab as I,aA as de,ad as q,ae as x,an as me,am as ue,af as O,ac as z,ah as xe,ai as fe,aj as f,b as $,T as he,S as ge,H as pe,a6 as we}from"./index-DIxCcwTo.js";import{A as je,a as be,b as Ne,c as ye,d as ve,e as Se,f as ke,g as Ee}from"./alert-dialog-BZ66Hhja.js";import{T as D}from"./trash-2-2bzzvvn1.js";import{E as Ce}from"./ellipsis-vertical-BUWmQ5u3.js";import{E as Ae}from"./eye-DkAcDlvf.js";import{S as De}from"./shopping-bag-D3keASlR.js";function Pe(){const[n,p]=o.useState([]),[B,w]=o.useState(!0),[N,Y]=o.useState("all"),[c,V]=o.useState(null),[H,y]=o.useState(new Set),[j,T]=o.useState(!0),[v,G]=o.useState(0),[h,k]=o.useState(!0),[J,E]=o.useState(!1),[_,W]=o.useState(null),[l,X]=o.useState(!1),[K,Q]=o.useState(!1);o.useEffect(()=>{M(),Z();const s=()=>{M()},t=()=>k(!0),r=()=>k(!1);return window.addEventListener("resize",s),window.addEventListener("online",t),window.addEventListener("offline",r),()=>{window.removeEventListener("resize",s),window.removeEventListener("online",t),window.removeEventListener("offline",r)}},[]),o.useEffect(()=>{R()},[]),o.useEffect(()=>{const s=n.filter(t=>!t.is_read).length;if(G(s),s>0&&n.length>0){const t=n[0];!t.is_read&&Date.now()-new Date(t.created_at).getTime()<5e3&&ee()}},[n,j]);const M=()=>{const s=window.innerWidth;X(s<768),Q(s>=768&&s<1024)},Z=()=>{k(navigator.onLine)},ee=()=>{if(j)try{const s=new(window.AudioContext||window.webkitAudioContext),t=s.createOscillator(),r=s.createGain();t.connect(r),r.connect(s.destination),t.frequency.value=800,r.gain.value=.1,t.start(),setTimeout(()=>t.stop(),100)}catch{console.log("Audio not supported on this device")}},R=async()=>{if(!h){a.error("You're offline. Please check your connection."),w(!1);return}try{const{data:{user:s},error:t}=await u.auth.getUser();if(t)throw console.error("Auth error:",t),new Error("Authentication failed");if(s){V(s.id),await S(s.id),se(s.id);const r=localStorage.getItem("notificationSoundEnabled");r!==null&&T(JSON.parse(r))}else a.error("Please sign in to view notifications"),w(!1)}catch(s){console.error("Error initializing user:",s);const t=s instanceof Error?s.message:"Failed to load notifications";a.error(t),w(!1)}},S=async s=>{try{w(!0);const{data:t,error:r}=await u.from("notifications").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(l?25:50);if(r)throw console.error("Error fetching notifications:",r),new Error("Failed to load notifications from server");const i=(t||[]).map(d=>te(d));p(i),W(new Date)}catch(t){console.error("Error loading notifications:",t);const r=t instanceof Error?t.message:"Failed to load notifications";a.error(r)}finally{w(!1)}},se=s=>{try{const t=u.channel("notifications-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${s}`},r=>{console.log("Real-time notification received:",r),S(s),l||a.info("New notification received!")}).subscribe(r=>{r==="SUBSCRIBED"&&console.log("Real-time notifications subscription active")});return()=>{t.unsubscribe()}}catch(t){console.error("Error setting up real-time subscription:",t)}},te=s=>{let t=g,r="text-gray-600",i="bg-gray-100",d="system",m="medium";switch(s.type){case"order":t=De,r="text-green-600",i="bg-green-50",d="order",m="high";break;case"message":t=we,r="text-blue-600",i="bg-blue-50",d="message",m="high";break;case"favorite":t=pe,r="text-pink-600",i="bg-pink-50",d="favorite",m="low";break;case"review":t=ge,r="text-yellow-600",i="bg-yellow-50",d="review",m="medium";break;case"product":t=he,r="text-purple-600",i="bg-purple-50",d="product",m="medium";break;default:t=g,r="text-gray-600",i="bg-gray-50",d="system",m="low"}return{...s,icon:t,color:r,bgColor:i,type:d,priority:m}},re=()=>{const s=!j;T(s),localStorage.setItem("notificationSoundEnabled",JSON.stringify(s)),a.success(`Notification sound ${s?"enabled":"disabled"}`,{duration:l?2e3:4e3})},U=async s=>{if(!c){a.error("Please sign in to perform this action");return}if(!h){a.error("You're offline. Please check your connection.");return}try{y(r=>new Set(r).add(s));const{error:t}=await u.from("notifications").update({is_read:!0}).eq("id",s).eq("user_id",c);if(t)throw new Error("Failed to mark notification as read");p(r=>r.map(i=>i.id===s?{...i,is_read:!0}:i)),a.success("Notification marked as read",{duration:l?2e3:3e3})}catch(t){console.error("Error marking notification as read:",t);const r=t instanceof Error?t.message:"Failed to mark as read";a.error(r)}finally{y(t=>{const r=new Set(t);return r.delete(s),r})}},ae=async()=>{if(!c){a.error("Please sign in to perform this action");return}if(!h){a.error("You're offline. Please check your connection.");return}try{if(n.filter(r=>!r.is_read).length===0){a.info("No unread notifications");return}const{error:t}=await u.from("notifications").update({is_read:!0}).eq("user_id",c).eq("is_read",!1);if(t)throw new Error("Failed to mark all notifications as read");p(r=>r.map(i=>({...i,is_read:!0}))),a.success("All notifications marked as read")}catch(s){console.error("Error marking all as read:",s);const t=s instanceof Error?s.message:"Failed to mark all as read";a.error(t)}},ie=async s=>{if(!c){a.error("Please sign in to perform this action");return}if(!h){a.error("You're offline. Please check your connection.");return}try{y(r=>new Set(r).add(s));const{error:t}=await u.from("notifications").delete().eq("id",s).eq("user_id",c);if(t)throw new Error("Failed to delete notification");p(r=>r.filter(i=>i.id!==s)),a.success("Notification deleted")}catch(t){console.error("Error deleting notification:",t);const r=t instanceof Error?t.message:"Failed to delete notification";a.error(r)}finally{y(t=>{const r=new Set(t);return r.delete(s),r})}},ne=async()=>{if(!c){a.error("Please sign in to perform this action");return}if(!h){a.error("You're offline. Please check your connection.");return}try{if(n.length===0){a.info("No notifications to clear");return}const{error:s}=await u.from("notifications").delete().eq("user_id",c);if(s)throw new Error("Failed to clear notifications");p([]),E(!1),a.success("All notifications cleared")}catch(s){console.error("Error clearing notifications:",s);const t=s instanceof Error?s.message:"Failed to clear notifications";a.error(t)}},oe=s=>{switch(s){case"high":return"border-l-red-500 bg-red-50/50";case"medium":return"border-l-yellow-500 bg-yellow-50/50";case"low":return"border-l-gray-400 bg-gray-50/50";default:return"border-l-gray-400"}},L=N==="all"?n:N==="unread"?n.filter(s=>!s.is_read):n.filter(s=>s.type===N),le=()=>l?"grid grid-cols-2 gap-1":K?"grid grid-cols-4 gap-2":"grid grid-cols-3 lg:grid-cols-7 gap-2";return B?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center space-y-4 max-w-sm mx-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"w-12 h-12 animate-spin text-primary mx-auto"}),e.jsx(g,{className:"w-6 h-6 text-primary absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent mb-2",children:"Loading Notifications"}),e.jsx("p",{className:"text-muted-foreground",children:"Getting your latest updates..."})]})]})}):c?e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20",children:[e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 py-6 max-w-7xl",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-xl",children:e.jsx(g,{className:"w-6 h-6 sm:w-8 sm:h-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Notifications"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:"Stay updated with your activity"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!h&&e.jsx(A,{variant:"outline",className:"text-xs bg-yellow-50 text-yellow-700 border-yellow-200",children:"Offline"}),e.jsxs(F,{children:[e.jsx(I,{asChild:!0,children:e.jsx(b,{variant:"outline",size:l?"icon":"default",children:l?e.jsx(de,{className:"w-4 h-4"}):"Settings"})}),e.jsxs(q,{align:"end",children:[e.jsxs(x,{onClick:re,children:[j?e.jsx(me,{className:"w-4 h-4 mr-2"}):e.jsx(ue,{className:"w-4 h-4 mr-2"}),j?"Disable Sound":"Enable Sound"]}),e.jsxs(x,{onClick:()=>c&&S(c),children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Refresh"]}),e.jsx(O,{}),v>0&&e.jsxs(x,{onClick:ae,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Mark All Read"]}),e.jsxs(x,{onClick:()=>E(!0),className:"text-red-600",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Clear All"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-card/50 rounded-lg border border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(g,{className:"w-4 h-4 text-primary"}),"Total: ",n.length]}),v>0&&e.jsxs(A,{variant:"destructive",className:"animate-pulse",children:[v," Unread"]})]}),_&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Updated ",_.toLocaleTimeString()]})]})]}),e.jsx(xe,{value:N,onValueChange:Y,className:"mb-6",children:e.jsxs(fe,{className:`w-full ${le()} p-1 bg-muted/50`,children:[e.jsxs(f,{value:"all",className:"text-xs sm:text-sm py-2",children:["All",!l&&` (${n.length})`]}),e.jsxs(f,{value:"unread",className:"text-xs sm:text-sm py-2",children:["Unread",!l&&` (${v})`]}),e.jsx(f,{value:"order",className:"text-xs sm:text-sm py-2",children:"Orders"}),e.jsx(f,{value:"message",className:"text-xs sm:text-sm py-2",children:"Messages"}),!l&&e.jsxs(e.Fragment,{children:[e.jsx(f,{value:"favorite",className:"text-xs sm:text-sm py-2",children:"Favorites"}),e.jsx(f,{value:"review",className:"text-xs sm:text-sm py-2",children:"Reviews"}),e.jsx(f,{value:"system",className:"text-xs sm:text-sm py-2",children:"System"})]})]})}),e.jsx("div",{className:"space-y-3",children:L.length>0?L.map(s=>{const t=s.icon,r=H.has(s.id);return e.jsx($,{className:`p-4 transition-all duration-300 border-l-4 ${oe(s.priority)} ${s.is_read?"border-border/50":"shadow-md ring-1 ring-primary/20"} hover:shadow-lg hover:scale-[1.02]`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${s.bgColor} flex-shrink-0 mt-1`,children:e.jsx(t,{className:`w-4 h-4 sm:w-5 sm:h-5 ${s.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold mb-1 line-clamp-2",children:s.title}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground line-clamp-2",children:s.message})]}),!s.is_read&&e.jsx(A,{variant:"default",className:"flex-shrink-0 text-xs animate-pulse",children:"New"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.created_at).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsx("div",{className:"flex gap-1",children:e.jsxs(F,{children:[e.jsx(I,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"icon",className:"h-8 w-8",disabled:r,children:r?e.jsx(P,{className:"w-3 h-3 animate-spin"}):e.jsx(Ce,{className:"w-3 h-3"})})}),e.jsxs(q,{align:"end",className:"w-48",children:[!s.is_read&&e.jsxs(x,{onClick:()=>U(s.id),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Mark as Read"]}),e.jsxs(x,{onClick:()=>U(s.id),children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),s.is_read?"Mark Unread":"Mark Read"]}),e.jsx(O,{}),e.jsxs(x,{onClick:()=>ie(s.id),className:"text-red-600",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]})]})]})},s.id)}):e.jsx($,{className:"p-8 sm:p-12 text-center border-border/50 bg-card/50",children:e.jsxs("div",{className:"max-w-sm mx-auto",children:[e.jsx(g,{className:"w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4 text-muted-foreground/40"}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2",children:n.length===0?"No Notifications":"No Matching Notifications"}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground mb-6",children:n.length===0?"You're all caught up! New notifications will appear here.":"No notifications match your current filter."}),n.length===0&&e.jsxs(b,{onClick:()=>c&&S(c),variant:"outline",size:l?"sm":"default",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Refresh"]})]})})})]}),e.jsx(je,{open:J,onOpenChange:E,children:e.jsxs(be,{className:"max-w-sm sm:max-w-md",children:[e.jsxs(Ne,{children:[e.jsxs(ye,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-destructive"}),"Clear All Notifications?"]}),e.jsxs(ve,{children:["This will permanently delete all ",n.length," ","notifications. This action cannot be undone."]})]}),e.jsxs(Se,{children:[e.jsx(ke,{children:"Cancel"}),e.jsx(Ee,{onClick:ne,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Clear All"})]})]})})]}):e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md mx-auto",children:[e.jsx(ce,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please sign in to view your notifications"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(b,{onClick:R,className:"w-full sm:w-auto",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Retry Connection"]}),e.jsx(b,{variant:"outline",asChild:!0,className:"w-full sm:w-auto",children:e.jsx("a",{href:"/signin",children:"Sign In"})})]})]})})}export{Pe as default};
