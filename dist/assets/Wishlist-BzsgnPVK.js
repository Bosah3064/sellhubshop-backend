import{r as i,v as q,s as d,al as o,j as e,q as y,H as f,d as x,B as n,b as C,aa as I,ab as O,ad as H,ae as p,e as V,E as Y,a1 as K,M as R,a0 as G,a2 as J,L as _,g as Q}from"./index-DIxCcwTo.js";import{A as X,a as Z,b as ee,c as re,d as se,e as ae,f as te,g as le}from"./alert-dialog-BZ66Hhja.js";import{C as ie}from"./ContactSellerDialog-Fr5gEQDa.js";import{T as b}from"./trash-2-2bzzvvn1.js";import{E as oe}from"./ellipsis-vertical-BUWmQ5u3.js";import{S as ne}from"./share-2-9Fu0c9JZ.js";import{M as S}from"./message-circle-C61Fvmn6.js";import{E as ce}from"./eye-DkAcDlvf.js";import{C as de}from"./calendar-CuODnOhg.js";import"./dialog-YYEI7PMn.js";import"./avatar-C_jNKov4.js";import"./copy-YHHq3K_B.js";function ye(){const[c,m]=i.useState([]),[k,v]=i.useState(!0),[h,w]=i.useState(new Set),[D,u]=i.useState(!1),g=q();i.useEffect(()=>{A()},[]);const A=async()=>{try{v(!0);const{data:{user:r}}=await d.auth.getUser();if(!r){o.error("Please sign in to view your wishlist"),g("/signin");return}const{data:a,error:t}=await d.from("favorites").select(`
          id,
          created_at,
          products (
            id,
            name,
            price,
            category,
            images,
            condition,
            status,
            location,
            created_at,
            user_id,
            profiles!products_user_id_fkey (
              username,
              full_name,
              avatar_url,
              phone,
              whatsapp
            )
          )
        `).eq("user_id",r.id).order("created_at",{ascending:!1});if(t)throw console.error("Error loading favorites:",t),t;if(!a){m([]);return}const l=a.filter(s=>s.products!==null).map(s=>({id:s.products.id,product_id:s.products.id,name:s.products.name,price:s.products.price,category:s.products.category,images:s.products.images||[],seller_id:s.products.user_id,seller_name:s.products.profiles?.full_name||s.products.profiles?.username||"Unknown Seller",seller_avatar:s.products.profiles?.avatar_url||null,seller_phone:s.products.profiles?.phone,seller_whatsapp:s.products.profiles?.whatsapp,condition:s.products.condition,status:s.products.status,location:s.products.location,created_at:s.created_at,favorite_id:s.id}));m(l)}catch(r){console.error("Failed to load favorites:",r),o.error("Failed to load your wishlist. Please try again.")}finally{v(!1)}},E=async(r,a)=>{try{w(l=>new Set(l).add(r));const{error:t}=await d.from("favorites").delete().eq("id",r);if(t)throw console.error("Error removing favorite:",t),t;m(l=>l.filter(s=>s.favorite_id!==r)),o.success(`"${a}" removed from wishlist`)}catch(t){console.error("Failed to remove favorite:",t),o.error("Failed to remove item from wishlist. Please try again.")}finally{w(t=>{const l=new Set(t);return l.delete(r),l})}},P=async()=>{try{const{data:{user:r}}=await d.auth.getUser();if(!r)return;const{error:a}=await d.from("favorites").delete().eq("user_id",r.id);if(a)throw console.error("Error clearing favorites:",a),a;m([]),u(!1),o.success("All items removed from wishlist")}catch(r){console.error("Failed to clear favorites:",r),o.error("Failed to clear wishlist. Please try again.")}},F=r=>{const a=`${window.location.origin}/product/${r.id}`;navigator.clipboard.writeText(a).then(()=>{o.success("Product link copied to clipboard!")}).catch(()=>{o.error("Failed to copy link. Please try again.")})},[M,T]=i.useState(null),[z,L]=i.useState(null),[U,j]=i.useState(!1),N=r=>{L({name:r.name,price:r.price,currency:"KES"}),T({full_name:r.seller_name,profile_image:r.seller_avatar,phone:r.seller_phone||"",whatsapp:r.seller_whatsapp||""}),j(!0)},$=r=>{g(`/product/${r.id}`)},B=r=>{g(`/product/${r.id}`)},W=r=>{switch(r?.toLowerCase()){case"new":return"bg-green-100 text-green-800 border-green-200";case"like new":return"bg-blue-100 text-blue-800 border-blue-200";case"used":return"bg-amber-100 text-amber-800 border-amber-200";case"refurbished":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return k?e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"w-12 h-12 animate-spin text-primary mx-auto"}),e.jsx(f,{className:"w-6 h-6 text-red-500 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent mb-2",children:"Loading Your Wishlist"}),e.jsx("p",{className:"text-muted-foreground",children:"Gathering your favorite items..."})]})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-background to-muted/20",children:[e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-red-50 to-pink-100 rounded-2xl mb-6 border border-red-200",children:e.jsx(f,{className:"w-10 h-10 text-red-500 fill-red-500"})}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"My Wishlist"}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto mb-6",children:"Your curated collection of favorite products"}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs(x,{variant:"secondary",className:"text-lg px-4 py-2 bg-primary/10 text-primary border-primary/20",children:[c.length," ",c.length===1?"Premium Item":"Premium Items"]}),c.length>0&&e.jsxs(n,{variant:"outline",onClick:()=>u(!0),size:"lg",className:"border-destructive/20 text-destructive hover:bg-destructive/10",disabled:h.size>0,children:[e.jsx(b,{className:"w-5 h-5 mr-2"}),"Clear All"]})]})]}),c.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:c.map(r=>e.jsxs(C,{className:"group overflow-hidden border-border/50 hover:border-primary/30 transition-all duration-300 hover:shadow-xl bg-card/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-muted/20",children:[e.jsx("img",{src:r.images[0]||"/placeholder.svg",alt:r.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105",onError:a=>{a.currentTarget.src="/placeholder.svg"}}),r.status!=="active"&&e.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:e.jsx(x,{variant:"destructive",className:"text-sm px-3 py-2 bg-white/20 backdrop-blur-sm text-white border-0",children:r.status.toUpperCase()})}),e.jsxs("div",{className:"absolute top-3 right-3 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[e.jsx(n,{variant:"destructive",size:"icon",className:"h-9 w-9 bg-white/90 backdrop-blur-sm hover:bg-white shadow-lg",onClick:()=>E(r.favorite_id,r.name),disabled:h.has(r.favorite_id),children:h.has(r.favorite_id)?e.jsx(y,{className:"w-4 h-4 animate-spin"}):e.jsx(b,{className:"w-4 h-4"})}),e.jsxs(I,{children:[e.jsx(O,{asChild:!0,children:e.jsx(n,{variant:"secondary",size:"icon",className:"h-9 w-9 bg-white/90 backdrop-blur-sm hover:bg-white shadow-lg",children:e.jsx(oe,{className:"w-4 h-4"})})}),e.jsxs(H,{align:"end",className:"w-48",children:[e.jsxs(p,{onClick:()=>F(r),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Share Product"]}),e.jsxs(p,{onClick:()=>N(r),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Contact Seller"]}),e.jsxs(p,{onClick:()=>B(r),children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"View Details"]})]})]})]}),r.condition&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx(x,{variant:"outline",className:`text-xs font-medium ${W(r.condition)}`,children:r.condition})})]}),e.jsxs(V,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs(x,{variant:"secondary",className:"text-xs font-medium",children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),r.category]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["KES ",r.price.toLocaleString()]})})]}),e.jsx("h3",{className:"text-lg font-semibold mb-3 line-clamp-2 leading-tight group-hover:text-primary transition-colors",children:r.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 p-3 bg-muted/30 rounded-lg",children:[r.seller_avatar?e.jsx("img",{src:r.seller_avatar,alt:r.seller_name,className:"w-8 h-8 rounded-full border-2 border-background"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center border-2 border-background",children:e.jsx(K,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:r.seller_name}),r.location&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),r.location]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-4",children:[e.jsx(de,{className:"w-3 h-3"}),"Added"," ",new Date(r.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]})]}),e.jsx(G,{className:"p-6 pt-0",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[e.jsxs(n,{variant:"default",size:"sm",className:"w-full font-medium",onClick:()=>$(r),disabled:r.status!=="active",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),r.status==="active"?"Buy Now":"Unavailable"]}),e.jsxs(n,{variant:"outline",size:"sm",className:"w-full font-medium",onClick:()=>N(r),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Contact"]})]})})]},r.favorite_id))}):e.jsx(C,{className:"max-w-2xl mx-auto border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-muted to-muted/50 rounded-2xl flex items-center justify-center mx-auto mb-6 border border-border",children:e.jsx(f,{className:"w-12 h-12 text-muted-foreground/60"})}),e.jsx("h3",{className:"text-2xl font-bold mb-3 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent",children:"Your Wishlist Awaits"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-8 max-w-md mx-auto",children:"Start building your collection of favorite products. Items you love will appear here for easy access."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx(_,{to:"/marketplace",children:e.jsxs(n,{size:"lg",className:"w-full sm:w-auto bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90",children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),"Explore Marketplace"]})}),e.jsx(_,{to:"/search",children:e.jsx(n,{variant:"outline",size:"lg",className:"w-full sm:w-auto border-primary/20",children:"Search Products"})})]})]})})]}),e.jsx(X,{open:D,onOpenChange:u,children:e.jsxs(Z,{className:"bg-background",children:[e.jsxs(ee,{children:[e.jsxs(re,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-destructive"}),"Clear Entire Wishlist?"]}),e.jsxs(se,{children:["This will remove all ",c.length," items from your wishlist. This action cannot be undone."]})]}),e.jsxs(ae,{children:[e.jsx(te,{children:"Cancel"}),e.jsx(le,{onClick:P,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Clear All Items"})]})]})}),e.jsx(ie,{open:U,onOpenChange:j,sellerProfile:M,product:z})]})}export{ye as default};
