import{c as ee,u as re,r as l,s as u,j as e,g as $,b as v,x as B,y as U,S as _,e as w,aV as se,B as c,aX as q,f as te,aa as ae,ab as ie,ad as le,aY as ne,af as oe,aZ as ce,ae as j,d as de}from"./index-DIxCcwTo.js";import{T as me}from"./textarea-QQPFZBv8.js";import{A as ue,a as xe,b as he}from"./avatar-C_jNKov4.js";import{M as z}from"./message-circle-C61Fvmn6.js";import{F as ge}from"./filter-CcvaBCEE.js";import{T as fe}from"./thumbs-up-dZPjuOmQ.js";import{F as pe}from"./flag-CVw0EwOT.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=ee("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);function Se(){const{toast:i}=re(),[d,y]=l.useState(0),[m,N]=l.useState(""),[L,x]=l.useState([]),[P,h]=l.useState(!0),[k,M]=l.useState(!1),[T,F]=l.useState(0),[D,H]=l.useState(0),[W,E]=l.useState([]),[g,Y]=l.useState(null),[I,f]=l.useState("recent"),[o,R]=l.useState(null);l.useEffect(()=>{A()},[]);const O=async r=>{try{const{data:s}=await u.from("products").select("user_id").neq("user_id",r).limit(5);if(s&&s.length>0)return s[0].user_id;const{data:t}=await u.from("profiles").select("id").neq("id",r).limit(1);return t?.[0]?.id||null}catch(s){return console.error("Error finding seller:",s),null}},A=async()=>{try{h(!0);const{data:{user:r}}=await u.auth.getUser();if(!r){i({title:"Authentication required",description:"Please sign in to view reviews",variant:"destructive"}),h(!1);return}const s=await O(r.id);if(!s){console.log("No seller found to display reviews for"),x([]),p([]),h(!1);return}Y(s);const{data:t,error:n}=await u.from("reviews").select(`
          *,
          reviewer:profiles!reviews_reviewer_id_fkey(
            full_name,
            avatar_url,
            username
          )
        `).eq("seller_id",s).order("created_at",{ascending:!1});if(n){console.error("Error fetching reviews:",n),i({title:"Error loading reviews",description:n.message,variant:"destructive"}),x([]),p([]);return}x(t||[]),p(t||[])}catch(r){console.error("Error loading reviews:",r),i({title:"Error loading reviews",description:"Failed to load reviews data",variant:"destructive"}),x([]),p([])}finally{h(!1)}},p=r=>{const s=r.length;if(H(s),s===0){F(0),E([{stars:5,count:0,percentage:0},{stars:4,count:0,percentage:0},{stars:3,count:0,percentage:0},{stars:2,count:0,percentage:0},{stars:1,count:0,percentage:0}]);return}const t=r.reduce((a,b)=>a+b.rating,0)/s;F(parseFloat(t.toFixed(1)));const n=[5,4,3,2,1].map(a=>{const b=r.filter(Q=>Q.rating===a).length,K=s>0?b/s*100:0;return{stars:a,count:b,percentage:K}});E(n)},G=async()=>{if(!d||!m.trim()){i({title:"Missing information",description:"Please provide both a rating and review text",variant:"destructive"});return}try{M(!0);const{data:{user:r}}=await u.auth.getUser();if(!r){i({title:"Authentication required",description:"Please sign in to submit a review",variant:"destructive"});return}if(!g){i({title:"No seller available",description:"Cannot submit review at this time",variant:"destructive"});return}const{error:s}=await u.from("reviews").insert({rating:d,comment:m.trim(),reviewer_id:r.id,seller_id:g,helpful_count:0,is_verified:!0});if(s){if(console.error("Review submission error:",s),s.message.includes("Cannot review yourself")){i({title:"Cannot review yourself",description:"You cannot leave a review for your own account",variant:"destructive"});return}throw s}i({title:"Review submitted!",description:"Thank you for your valuable feedback"}),y(0),N(""),A()}catch(r){console.error("Error submitting review:",r),i({title:"Failed to submit review",description:r.message||"There was an error submitting your review",variant:"destructive"})}finally{M(!1)}},V=async(r,s)=>{try{const{error:t}=await u.from("reviews").update({helpful_count:s+1}).eq("id",r);if(t)throw t;x(n=>n.map(a=>a.id===r?{...a,helpful_count:s+1}:a)),i({title:"Thank you for your feedback!",description:"Marked as helpful"})}catch(t){console.error("Error updating helpful count:",t),i({title:"Failed to update",description:"There was an error marking the review as helpful",variant:"destructive"})}},X=r=>{i({title:"Review reported",description:"Thank you for reporting this review. Our team will review it shortly."})},S=(r,s=!1,t="md")=>{const n={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"};return e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>e.jsx(_,{className:`${n[t]} ${a<=r?"fill-yellow-400 text-yellow-400":"text-gray-300"} ${s?"cursor-pointer hover:scale-110 transition-transform duration-200":""}`,onClick:()=>s&&y(a)},a))})},Z=r=>{const s=new Date(r),n=Math.abs(new Date().getTime()-s.getTime()),a=Math.ceil(n/(1e3*60*60*24));return a===1?"1 day ago":a<7?`${a} days ago`:a<30?`${Math.ceil(a/7)} weeks ago`:s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},J=()=>{let r=L;switch(o&&(r=r.filter(s=>s.rating===o)),I){case"recent":r=[...r].sort((s,t)=>new Date(t.created_at).getTime()-new Date(s.created_at).getTime());break;case"helpful":r=[...r].sort((s,t)=>(t.helpful_count||0)-(s.helpful_count||0));break;case"highest":r=[...r].sort((s,t)=>t.rating-s.rating);break;case"lowest":r=[...r].sort((s,t)=>s.rating-t.rating);break}return r};if(P)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-primary/5 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary mx-auto"}),e.jsx($,{className:"w-8 h-8 text-primary absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent mb-2",children:"Loading Reviews"}),e.jsx("p",{className:"text-muted-foreground",children:"Gathering community insights..."})]})]})});const C=J();return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-primary/5",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-primary/10 to-secondary/10 rounded-2xl mb-6 border border-primary/20",children:e.jsx($,{className:"w-10 h-10 text-primary"})}),e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent",children:"Customer Reviews"}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Share your experience and read authentic feedback from our community"})]}),e.jsxs("div",{className:"grid lg:grid-cols-4 gap-8 mb-12",children:[e.jsxs(v,{className:"lg:col-span-1 border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsx(B,{className:"text-center pb-4",children:e.jsxs(U,{className:"flex items-center justify-center gap-2 text-lg",children:[e.jsx(_,{className:"h-5 w-5 text-yellow-400 fill-yellow-400"}),"Overall Rating"]})}),e.jsxs(w,{className:"text-center space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold text-primary mb-2",children:T}),S(Math.round(T),!1,"lg"),e.jsxs("p",{className:"text-muted-foreground mt-3",children:["Based on ",D," verified reviews"]})]}),e.jsx("div",{className:"space-y-3",children:W.map(r=>e.jsxs("div",{className:"flex items-center gap-3 group cursor-pointer",onClick:()=>R(r.stars===o?null:r.stars),children:[e.jsxs("span",{className:"text-sm font-medium w-8 flex items-center gap-1",children:[r.stars,e.jsx(_,{className:"h-3 w-3 text-yellow-400 fill-yellow-400"})]}),e.jsx(se,{value:r.percentage,className:"flex-1 h-2 bg-muted/50",indicatorClassName:`${o===r.stars?"bg-primary":"bg-yellow-400"}`}),e.jsx("span",{className:"text-sm text-muted-foreground w-12 text-right",children:r.count})]},r.stars))}),o&&e.jsx(c,{variant:"outline",size:"sm",onClick:()=>R(null),className:"w-full",children:"Clear Filter"})]})]}),e.jsxs(v,{className:"lg:col-span-3 border-border/50 bg-card/50 backdrop-blur-sm",children:[e.jsx(B,{children:e.jsxs(U,{className:"flex items-center gap-2 text-xl",children:[e.jsx(z,{className:"h-5 w-5 text-green-600"}),"Share Your Experience"]})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-3 block",children:"How would you rate your experience?"}),e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/30 rounded-lg border border-border/50",children:[S(d,!0,"lg"),e.jsx("span",{className:"text-lg font-semibold text-primary",children:d>0?`${d} star${d>1?"s":""}`:"Select your rating"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-3 block",children:"Your Review"}),e.jsx(me,{placeholder:"Share details about your experience. What did you like? What could be improved? Your feedback helps others make better decisions.",value:m,onChange:r=>N(r.target.value),rows:5,className:"resize-none border-border/50 focus:border-primary/50 transition-colors",maxLength:500}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m.length,"/500 characters"]}),m.length>400&&e.jsxs("p",{className:"text-xs text-amber-600",children:[500-m.length," characters remaining"]})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(c,{onClick:G,disabled:!d||!m.trim()||k||!g,className:"flex-1 bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90",size:"lg",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Submitting Review..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-5 h-5 mr-2"}),"Submit Review"]})}),e.jsx(c,{variant:"outline",onClick:()=>{y(0),N("")},disabled:k,size:"lg",children:"Clear"})]}),!g&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-amber-800",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx("p",{className:"text-sm",children:"No active sellers available for review at the moment. Please check back later."})]})})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent",children:"Community Reviews"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[C.length," of ",D," reviews",o&&` â€¢ Filtered by ${o} stars`]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(ae,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(c,{variant:"outline",size:"sm",className:"border-border/50",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Sort",e.jsx(be,{className:"h-4 w-4 ml-2"})]})}),e.jsxs(le,{align:"end",className:"w-48",children:[e.jsx(ne,{children:"Sort Reviews By"}),e.jsx(oe,{}),e.jsxs(ce,{children:[e.jsx(j,{onClick:()=>f("recent"),children:"Most Recent"}),e.jsx(j,{onClick:()=>f("helpful"),children:"Most Helpful"}),e.jsx(j,{onClick:()=>f("highest"),children:"Highest Rated"}),e.jsx(j,{onClick:()=>f("lowest"),children:"Lowest Rated"})]})]})]})})]}),C.length>0?e.jsx("div",{className:"space-y-6",children:C.map(r=>e.jsx(v,{className:"border-border/50 hover:border-primary/30 transition-all duration-300 hover:shadow-lg bg-card/50 backdrop-blur-sm",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(ue,{className:"h-12 w-12 border-2 border-green-100 shadow-sm",children:[e.jsx(xe,{src:r.reviewer?.avatar_url}),e.jsx(he,{className:"bg-gradient-to-br from-green-100 to-green-200 text-green-700 font-semibold",children:r.reviewer?.full_name?.charAt(0)||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start justify-between mb-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:r.reviewer?.full_name||"Anonymous User"}),r.reviewer?.username&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",r.reviewer.username]})]}),r.is_verified&&e.jsxs(de,{variant:"secondary",className:"flex items-center gap-1 bg-green-50 text-green-700 border-green-200",children:[e.jsx(q,{className:"h-3 w-3 fill-current"}),"Verified Purchase"]})]}),e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:Z(r.created_at)})]}),e.jsx("div",{className:"mb-4",children:S(r.rating,!1,"md")}),e.jsx("p",{className:"text-foreground/80 leading-relaxed mb-4 whitespace-pre-wrap",children:r.comment}),e.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-border/50",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>V(r.id,r.helpful_count||0),className:"flex items-center gap-2 text-muted-foreground hover:text-green-600 hover:bg-green-50",children:[e.jsx(fe,{className:"h-4 w-4"}),"Helpful (",r.helpful_count||0,")"]}),e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>X(r.id),className:"flex items-center gap-2 text-muted-foreground hover:text-red-600 hover:bg-red-50",children:[e.jsx(pe,{className:"h-4 w-4"}),"Report"]})]})]})]})})},r.id))}):e.jsx(v,{className:"border-border/50 bg-card/50 backdrop-blur-sm",children:e.jsx(w,{className:"p-16 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(z,{className:"h-20 w-20 text-muted-foreground/40 mx-auto mb-6"}),e.jsx("h3",{className:"text-2xl font-bold text-foreground mb-3",children:"No reviews match your criteria"}),e.jsx("p",{className:"text-muted-foreground mb-8 leading-relaxed",children:o?`No ${o}-star reviews found. Try adjusting your filters to see more reviews.`:"Be the first to share your experience! Your review helps build trust in our community."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[o&&e.jsx(c,{variant:"outline",onClick:()=>R(null),children:"Clear Filters"}),e.jsx(c,{onClick:()=>document.querySelector("textarea")?.focus(),className:"bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90",children:"Write First Review"})]})]})})})]})]})})}export{Se as default};
